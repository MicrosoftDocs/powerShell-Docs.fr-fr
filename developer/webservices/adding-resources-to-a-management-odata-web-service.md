---
title: Ajout de ressources à un Service Web OData de gestion | Microsoft Docs
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: b6871f21bd666f9cd71dd336bb3f844cf472b56c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/03/2019
ms.locfileid: "56858365"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="84870-102">Ajout de ressources à un service web Management OData</span><span class="sxs-lookup"><span data-stu-id="84870-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="84870-103">Cet exemple montre comment ajouter une ressource à un service web de gestion OData existant en utilisant le Concepteur de schémas de gestion OData.</span><span class="sxs-lookup"><span data-stu-id="84870-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="84870-104">Le [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) exemple crée un service web qui expose les ressources de processus et le serveur.</span><span class="sxs-lookup"><span data-stu-id="84870-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="84870-105">Dans cet exemple, vous allez ajouter une ressource de Machine virtuelle (VM) pour le service web.</span><span class="sxs-lookup"><span data-stu-id="84870-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="84870-106">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="84870-106">Prerequisites</span></span>

<span data-ttu-id="84870-107">Cette rubrique part du principe que vous avez téléchargé et installé le [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) exemple comme décrit dans [création d’un Service de Web Windows PowerShell](./creating-a-management-odata-web-service.md), et que vous avez téléchargé et installé le [Concepteur de schémas de OData de gestion](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span><span class="sxs-lookup"><span data-stu-id="84870-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="84870-108">Cette rubrique suppose également que vous disposez du module PowerShell de Windows Hyper-V installé sur l’ordinateur où vous configurez le point de terminaison Odata de gestion.</span><span class="sxs-lookup"><span data-stu-id="84870-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="84870-109">Ajout de machine virtuelle en tant que ressource au Service Web</span><span class="sxs-lookup"><span data-stu-id="84870-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="84870-110">La première étape consiste à importer le schéma du point de terminaison OData de gestion existant dans le Concepteur de schémas.</span><span class="sxs-lookup"><span data-stu-id="84870-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="84870-111">La procédure suivante décrit comment procéder.</span><span class="sxs-lookup"><span data-stu-id="84870-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="84870-112">L’importation d’un schéma existant dans le Concepteur de schémas</span><span class="sxs-lookup"><span data-stu-id="84870-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="84870-113">Ouvrez le Concepteur de schémas de OData de gestion.</span><span class="sxs-lookup"><span data-stu-id="84870-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="84870-114">À partir de la **fichier** menu, sélectionnez **fichier** ; **Nouveau** ; **Fichier**.</span><span class="sxs-lookup"><span data-stu-id="84870-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="84870-115">Le **nouveau fichier** boîte de dialogue apparaît.</span><span class="sxs-lookup"><span data-stu-id="84870-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="84870-116">Cliquez sur **gestion OData modèle**, puis cliquez sur **Open**.</span><span class="sxs-lookup"><span data-stu-id="84870-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="84870-117">Avec le bouton droit dans la fenêtre principale, puis cliquez sur **fichier de schéma** ; **Importation**.</span><span class="sxs-lookup"><span data-stu-id="84870-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="84870-118">Le **Open** boîte de dialogue apparaît.</span><span class="sxs-lookup"><span data-stu-id="84870-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="84870-119">Accédez au dossier où vous configurez le service web de gestion OData pour le [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) exemple.</span><span class="sxs-lookup"><span data-stu-id="84870-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="84870-120">Si vous avez utilisé le script Windows PowerShell fourni avec cet exemple pour configurer le point de terminaison sans modifier le script, ce dossier est **C:\inetpub\wwwroot\Modata**.</span><span class="sxs-lookup"><span data-stu-id="84870-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="84870-121">Sélectionnez Schema.MOF, puis cliquez sur **Open**.</span><span class="sxs-lookup"><span data-stu-id="84870-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="84870-122">À ce stade, ouvrez les fichiers Schema.MOF et le fichier Schema.xml dans un éditeur de texte et notez qu’ils contiennent des mappages pour les ressources de processus et de Service.</span><span class="sxs-lookup"><span data-stu-id="84870-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="84870-123">Utilise le fichier Schema.MOF [Distributed Management Task Force](https://www.dmtf.org/) standard de (DTMF) MOF (Managed Object).</span><span class="sxs-lookup"><span data-stu-id="84870-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="84870-124">Le fichier schema.xml utilise un schéma XML qui est décrit dans [schéma de mappage de la ressource](./resource-mapping-schema.md).</span><span class="sxs-lookup"><span data-stu-id="84870-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="84870-125">La procédure suivante décrit comment importer les applets de commande Hyper-V vers le modèle de schéma.</span><span class="sxs-lookup"><span data-stu-id="84870-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="84870-126">L’importation des applets de commande dans le schéma</span><span class="sxs-lookup"><span data-stu-id="84870-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="84870-127">Avec le bouton droit sur une zone vide de la fenêtre Concepteur du schéma, puis cliquez sur **applets de commande Import**.</span><span class="sxs-lookup"><span data-stu-id="84870-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="84870-128">Le **Assistant Importation d’applet de commande** boîte de dialogue apparaît.</span><span class="sxs-lookup"><span data-stu-id="84870-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="84870-129">Assurez-vous que **ordinateur Local** est sélectionnée, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="84870-130">Assurez-vous qu’installé les Modules Windows PowerShell est sélectionné, puis sélectionnez Hyper-V à partir de la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="84870-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="84870-131">Cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-131">click **Next**.</span></span> <span data-ttu-id="84870-132">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-132">Click **Next**.</span></span>

4. <span data-ttu-id="84870-133">Dans le **substantif de l’applet de commande** liste, sélectionnez **machine virtuelle**.</span><span class="sxs-lookup"><span data-stu-id="84870-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="84870-134">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-134">Click **Next**</span></span>

5. <span data-ttu-id="84870-135">Pour cet exemple, nous liera uniquement les commandes Get et Delete avec les applets de commande.</span><span class="sxs-lookup"><span data-stu-id="84870-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="84870-136">Effacer la **créer** et **mise à jour** cases à cocher et assurez-vous que le **obtenir** et **supprimer** cases à cocher sont vérifiées.</span><span class="sxs-lookup"><span data-stu-id="84870-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="84870-137">Assurez-vous que le `Get-VM` applet de commande est sélectionnée pour **obtenir**et le `Remove-VM` applet de commande est sélectionnée pour **supprimer**.</span><span class="sxs-lookup"><span data-stu-id="84870-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="84870-138">Étant donné que les métadonnées pour les applets de commande de machine virtuelle ne spécifient pas un type de sortie, vous devez exécuter l’applet de commande pour spécifier le type de sortie.</span><span class="sxs-lookup"><span data-stu-id="84870-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="84870-139">Sélectionnez **type de sortie fournissez** et cliquez sur **exécuter l’applet de commande**.</span><span class="sxs-lookup"><span data-stu-id="84870-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="84870-140">Le **applet de commande exécuter** boîte de dialogue apparaît.</span><span class="sxs-lookup"><span data-stu-id="84870-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="84870-141">Cliquez sur **exécuter**.</span><span class="sxs-lookup"><span data-stu-id="84870-141">Click **Run**.</span></span> <span data-ttu-id="84870-142">Le **Type CLR** est alimentée avec les `VirtualMachine` type.</span><span class="sxs-lookup"><span data-stu-id="84870-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="84870-143">Cliquez sur **OK**, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="84870-144">Par défaut, toutes les propriétés de l’objet VirtualMachine sont sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="84870-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="84870-145">Vous pouvez effacer toutes les propriétés que vous ne souhaitez pas en tant que partie des données retournées lorsque vous demandez cette ressource à partir du service web.</span><span class="sxs-lookup"><span data-stu-id="84870-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="84870-146">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-146">Click **Next**.</span></span>

8. <span data-ttu-id="84870-147">Vous devez sélectionner au moins une propriété à utiliser en tant que clé.</span><span class="sxs-lookup"><span data-stu-id="84870-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="84870-148">Sélectionnez **nom** dans la liste, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="84870-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="84870-149">La fenêtre suivante vous permet de mapper des propriétés de la ressource de gestion OData aux propriétés des applets de commande sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="84870-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="84870-150">L’Assistant mappe les propriétés avec des noms identiques par défaut.</span><span class="sxs-lookup"><span data-stu-id="84870-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="84870-151">Par exemple, le `ComputerName` propriété de la ressource est mappée à la `ComputerName` propriété des applets de commande.</span><span class="sxs-lookup"><span data-stu-id="84870-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="84870-152">Cela vous permet de spécifier le `ComputerName` propriété dans une demande au service web et ont la valeur que vous spécifiez être passée à la `Get-VM` applet de commande.</span><span class="sxs-lookup"><span data-stu-id="84870-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="84870-153">`Id` et `Name` sont également mappés par défaut.</span><span class="sxs-lookup"><span data-stu-id="84870-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="84870-154">Cliquez sur **suivant**, puis cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="84870-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="84870-155">La ressource de machine virtuelle apparaît maintenant dans la fenêtre du Concepteur de schéma.</span><span class="sxs-lookup"><span data-stu-id="84870-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="84870-156">Vous pouvez examiner les propriétés et les opérations associées à la ressource.</span><span class="sxs-lookup"><span data-stu-id="84870-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="84870-157">Ensuite, vous allez exporter les fichiers de schéma mis à jour dans le répertoire virtuel pour le service web.</span><span class="sxs-lookup"><span data-stu-id="84870-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="84870-158">Exportation de fichiers de schéma depuis le Concepteur de schémas</span><span class="sxs-lookup"><span data-stu-id="84870-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="84870-159">Avec le bouton droit sur une zone vide de la fenêtre Concepteur du schéma, puis cliquez sur **fichier de schéma** ; **Exporter**.</span><span class="sxs-lookup"><span data-stu-id="84870-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="84870-160">Le **Enregistrer sous** boîte de dialogue apparaît.</span><span class="sxs-lookup"><span data-stu-id="84870-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="84870-161">Accédez au répertoire même à partir de l’endroit où vous avez importé le fichier MOF.</span><span class="sxs-lookup"><span data-stu-id="84870-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="84870-162">Nommez le fichier identique à celui du fichier MOF d’origine (\*.Schema.MOF par défaut), puis cliquez sur **enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="84870-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="84870-163">Confirmez que vous souhaitez remplacer le fichier existant.</span><span class="sxs-lookup"><span data-stu-id="84870-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="84870-164">Bien qu’il n’est pas défini explicitement dans le **Enregistrer sous** boîte de dialogue, il remplace le Schema.MOF et le fichier Schema.xml.</span><span class="sxs-lookup"><span data-stu-id="84870-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="84870-165">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="84870-165">Next Steps</span></span>

<span data-ttu-id="84870-166">Vous accédez à la nouvelle ressource de machine virtuelle à partir du service web de gestion OData, vous devez mettre à jour le fichier RbacConfiguration.xml pour autoriser l’accès au module Hyper-V Windows PowerShell comme décrit dans [en fonction du rôle de configuration de l’autorisation](./configuring-role-based-authorization.md), et vous devrez également redémarrer le service web.</span><span class="sxs-lookup"><span data-stu-id="84870-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>