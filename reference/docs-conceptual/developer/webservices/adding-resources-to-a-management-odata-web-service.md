---
title: Ajout de ressources à un service Web OData de gestion | Microsoft Docs
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: 52a67bcd9d7bf3e8600ea4302d1fa8970ff9c998
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/15/2019
ms.locfileid: "72359818"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="80b9b-102">Ajout de ressources à un service web Management OData</span><span class="sxs-lookup"><span data-stu-id="80b9b-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="80b9b-103">Cet exemple montre comment ajouter une ressource à un service Web OData de gestion existant à l’aide du concepteur de schémas OData de gestion.</span><span class="sxs-lookup"><span data-stu-id="80b9b-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="80b9b-104">L’exemple [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) crée un service Web qui expose les ressources de processus et de serveur.</span><span class="sxs-lookup"><span data-stu-id="80b9b-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="80b9b-105">Dans cet exemple, vous allez ajouter une ressource de machine virtuelle (VM) au service Web.</span><span class="sxs-lookup"><span data-stu-id="80b9b-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="80b9b-106">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="80b9b-106">Prerequisites</span></span>

<span data-ttu-id="80b9b-107">Cette rubrique part du principe que vous avez téléchargé et installé l’exemple [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) comme décrit dans [création d’un service Web Windows PowerShell](./creating-a-management-odata-web-service.md)et que vous avez téléchargé et installé le [Concepteur de schémas OData Management](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span><span class="sxs-lookup"><span data-stu-id="80b9b-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="80b9b-108">Cette rubrique suppose également que le module Windows PowerShell Hyper-V est installé sur l’ordinateur sur lequel vous avez configuré le point de terminaison OData de gestion.</span><span class="sxs-lookup"><span data-stu-id="80b9b-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="80b9b-109">Ajout d’une machine virtuelle en tant que ressource au service Web</span><span class="sxs-lookup"><span data-stu-id="80b9b-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="80b9b-110">La première étape consiste à importer le schéma à partir du point de terminaison de gestion OData existant dans le concepteur de schémas.</span><span class="sxs-lookup"><span data-stu-id="80b9b-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="80b9b-111">La procédure suivante décrit comment procéder.</span><span class="sxs-lookup"><span data-stu-id="80b9b-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="80b9b-112">Importation d’un schéma existant dans le concepteur de schémas</span><span class="sxs-lookup"><span data-stu-id="80b9b-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="80b9b-113">Ouvrez le concepteur de schémas OData de gestion.</span><span class="sxs-lookup"><span data-stu-id="80b9b-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="80b9b-114">Dans le menu **fichier** , sélectionnez **fichier** ; **Nouveau** ; **Fichier**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="80b9b-115">La boîte **de dialogue nouveau fichier** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="80b9b-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="80b9b-116">Cliquez sur **gestion OData Model**, puis sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="80b9b-117">Cliquez avec le bouton droit dans la fenêtre principale, puis cliquez sur **fichier de schéma** . **Importation**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="80b9b-118">La boîte de dialogue **ouvrir** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="80b9b-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="80b9b-119">Accédez au dossier dans lequel vous configurez le service Web OData de gestion pour l’exemple [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) .</span><span class="sxs-lookup"><span data-stu-id="80b9b-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="80b9b-120">Si vous avez utilisé le script Windows PowerShell fourni avec cet exemple pour configurer le point de terminaison sans modifier le script, ce dossier est **C:\inetpub\wwwroot\Modata**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="80b9b-121">Sélectionnez Schema. mof, puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="80b9b-122">À ce stade, ouvrez les fichiers Schema. mof et Schema. xml dans un éditeur de texte, et Notez qu’ils contiennent des mappages pour les ressources de processus et de service.</span><span class="sxs-lookup"><span data-stu-id="80b9b-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="80b9b-123">Le fichier Schema. mof utilise la norme MOF ( [Distributed Management Task Force](https://www.dmtf.org/) ).</span><span class="sxs-lookup"><span data-stu-id="80b9b-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="80b9b-124">Le fichier Schema. xml utilise un schéma XML qui est décrit dans [schéma de mappage des ressources](./resource-mapping-schema.md).</span><span class="sxs-lookup"><span data-stu-id="80b9b-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="80b9b-125">La procédure suivante décrit comment importer des applets de commande Hyper-V dans le modèle de schéma.</span><span class="sxs-lookup"><span data-stu-id="80b9b-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="80b9b-126">Importation des applets de commande dans le schéma</span><span class="sxs-lookup"><span data-stu-id="80b9b-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="80b9b-127">Cliquez avec le bouton droit sur une zone vide de la fenêtre du concepteur de schémas, puis cliquez sur **importer des applets**de commande.</span><span class="sxs-lookup"><span data-stu-id="80b9b-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="80b9b-128">La boîte de dialogue **Assistant importation d’applet** de commande s’affiche.</span><span class="sxs-lookup"><span data-stu-id="80b9b-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="80b9b-129">Assurez-vous que l’option **ordinateur local** est sélectionnée, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="80b9b-130">Assurez-vous que l’option modules Windows PowerShell installés est sélectionnée, puis sélectionnez Hyper-V dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="80b9b-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="80b9b-131">Cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-131">click **Next**.</span></span> <span data-ttu-id="80b9b-132">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-132">Click **Next**.</span></span>

4. <span data-ttu-id="80b9b-133">Dans la liste nom de l' **applet** de commande, sélectionnez **VM**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="80b9b-134">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-134">Click **Next**</span></span>

5. <span data-ttu-id="80b9b-135">Pour cet exemple, nous allons lier uniquement les commandes obtenir et supprimer avec des applets de commande.</span><span class="sxs-lookup"><span data-stu-id="80b9b-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="80b9b-136">Désactivez les cases à cocher **créer** et **mettre à jour** , et assurez-vous que les cases à cocher **récupérer** et **supprimer** sont activées.</span><span class="sxs-lookup"><span data-stu-id="80b9b-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="80b9b-137">Assurez-vous que l’applet de commande `Get-VM` est sélectionnée pour **obtenir**et que l’applet de commande `Remove-VM` est sélectionnée pour la **suppression**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="80b9b-138">Étant donné que les métadonnées des applets de commande de machine virtuelle ne spécifient pas de type de sortie, vous devez exécuter l’applet de commande pour spécifier le type de sortie.</span><span class="sxs-lookup"><span data-stu-id="80b9b-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="80b9b-139">Sélectionnez **fournir le type de sortie** , puis cliquez sur **exécuter l’applet de commande**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="80b9b-140">La boîte de dialogue **exécuter l’applet de commande** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="80b9b-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="80b9b-141">Cliquez sur **exécuter**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-141">Click **Run**.</span></span> <span data-ttu-id="80b9b-142">La zone de **type CLR** est remplie avec le type `VirtualMachine`.</span><span class="sxs-lookup"><span data-stu-id="80b9b-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="80b9b-143">Cliquez sur **OK**, puis sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="80b9b-144">Par défaut, toutes les propriétés de l’objet VirtualMachine sont sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="80b9b-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="80b9b-145">Vous pouvez effacer toutes les propriétés que vous ne souhaitez pas inclure dans les données retournées lorsque vous demandez cette ressource à partir du service Web.</span><span class="sxs-lookup"><span data-stu-id="80b9b-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="80b9b-146">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-146">Click **Next**.</span></span>

8. <span data-ttu-id="80b9b-147">Vous devez sélectionner au moins une propriété à utiliser comme clé.</span><span class="sxs-lookup"><span data-stu-id="80b9b-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="80b9b-148">Sélectionnez **nom** dans la liste, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="80b9b-149">La fenêtre suivante vous permet de mapper les propriétés de la ressource OData de gestion aux propriétés des applets de commande sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="80b9b-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="80b9b-150">L’Assistant mappe les propriétés avec des noms identiques par défaut.</span><span class="sxs-lookup"><span data-stu-id="80b9b-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="80b9b-151">Par exemple, la propriété `ComputerName` de la ressource est mappée à la propriété `ComputerName` des applets de commande.</span><span class="sxs-lookup"><span data-stu-id="80b9b-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="80b9b-152">Cela vous permet de spécifier la propriété `ComputerName` dans une demande adressée au service Web et de faire en sorte que la valeur que vous spécifiez soit transmise à l’applet de commande `Get-VM`.</span><span class="sxs-lookup"><span data-stu-id="80b9b-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="80b9b-153">`Id` et `Name` sont également mappés par défaut.</span><span class="sxs-lookup"><span data-stu-id="80b9b-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="80b9b-154">Cliquez sur **suivant**, puis sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="80b9b-155">La ressource de machine virtuelle s’affiche maintenant dans la fenêtre du concepteur de schémas.</span><span class="sxs-lookup"><span data-stu-id="80b9b-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="80b9b-156">Vous pouvez examiner les propriétés et les opérations associées à la ressource.</span><span class="sxs-lookup"><span data-stu-id="80b9b-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="80b9b-157">Ensuite, vous allez exporter les fichiers de schéma mis à jour dans le répertoire virtuel pour le service Web.</span><span class="sxs-lookup"><span data-stu-id="80b9b-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="80b9b-158">Exportation de fichiers de schéma à partir du concepteur de schémas</span><span class="sxs-lookup"><span data-stu-id="80b9b-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="80b9b-159">Cliquez avec le bouton droit sur une zone vide de la fenêtre du concepteur de schémas, puis cliquez sur **fichier de schéma** . **Exportation**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="80b9b-160">La boîte de dialogue **Enregistrer sous** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="80b9b-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="80b9b-161">Accédez au même répertoire que celui à partir duquel vous avez importé le fichier MOF.</span><span class="sxs-lookup"><span data-stu-id="80b9b-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="80b9b-162">Nommez le fichier de la même façon que le fichier MOF d’origine (Schema. mof par défaut), puis cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="80b9b-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="80b9b-163">Confirmez que vous souhaitez remplacer le fichier existant.</span><span class="sxs-lookup"><span data-stu-id="80b9b-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="80b9b-164">Bien qu’elle ne soit pas explicitement indiquée dans la boîte de dialogue **Enregistrer sous** , les fichiers Schema. mof et Schema. XML sont remplacés.</span><span class="sxs-lookup"><span data-stu-id="80b9b-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="80b9b-165">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="80b9b-165">Next Steps</span></span>

<span data-ttu-id="80b9b-166">Avant d’accéder à la nouvelle ressource de machine virtuelle à partir du service Web OData de gestion, vous devez mettre à jour le fichier RbacConfiguration. xml pour autoriser l’accès au module Windows PowerShell Hyper-V, comme décrit dans Configuration de l' [autorisation basée sur les rôles](./configuring-role-based-authorization.md), et vous pouvez également vous devez redémarrer le service Web.</span><span class="sxs-lookup"><span data-stu-id="80b9b-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>