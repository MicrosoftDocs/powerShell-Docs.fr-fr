---
ms.date: 12/12/2018
keywords: dsc,powershell,configuration,installation
title: Configuration du gestionnaire de configuration local dans PowerShell 4.0
description: Le Gestionnaire de configuration local (LCM) s’exécute sur chaque nœud cible et gère l’analyse et l’application des configurations envoyées au nœud.
ms.openlocfilehash: cf4d8cffdb6492f9f8cdde4cbb82ba5843427cee
ms.sourcegitcommit: 488a940c7c828820b36a6ba56c119f64614afc29
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/27/2020
ms.locfileid: "92646976"
---
# <a name="configuring-the-lcm-in-powershell-40"></a><span data-ttu-id="d0990-104">Configuration du gestionnaire de configuration local dans PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="d0990-104">Configuring the LCM in PowerShell 4.0</span></span>

><span data-ttu-id="d0990-105">S’applique à : Windows PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="d0990-105">Applies To: Windows PowerShell 4.0</span></span>

<span data-ttu-id="d0990-106">**Pour plus d’informations sur Windows PowerShell 5.0 et ultérieur, consultez [Configuration du Gestionnaire de Configuration local](metaConfig.md).**</span><span class="sxs-lookup"><span data-stu-id="d0990-106">**For information related to Windows PowerShell 5.0 and later, see [Configuring the Local Configuration Manager](metaConfig.md).**</span></span>

<span data-ttu-id="d0990-107">Le Gestionnaire de configuration local (ou « LCM ») est le moteur de la fonctionnalité DSC (Desired State Configuration) de Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d0990-107">Local Configuration Manager is the Windows PowerShell Desired State Configuration (DSC) engine.</span></span> <span data-ttu-id="d0990-108">Exécuté sur tous les nœuds cibles, il est chargé d’appeler les ressources de configuration contenues dans un script de configuration DSC.</span><span class="sxs-lookup"><span data-stu-id="d0990-108">It runs on all target nodes, and it is responsible for calling the configuration resources that are included in a DSC configuration script.</span></span> <span data-ttu-id="d0990-109">Cette rubrique répertorie les propriétés du Gestionnaire de configuration local et explique comment modifier les paramètres du Gestionnaire de configuration local sur un nœud cible.</span><span class="sxs-lookup"><span data-stu-id="d0990-109">This topic lists the properties of Local Configuration Manager and describes how you can modify the Local Configuration Manager settings on a target node.</span></span>

## <a name="local-configuration-manager-properties"></a><span data-ttu-id="d0990-110">Propriétés du Gestionnaire de configuration local</span><span class="sxs-lookup"><span data-stu-id="d0990-110">Local Configuration Manager properties</span></span>

<span data-ttu-id="d0990-111">Vous pouvez définir ou récupérer les différentes propriétés du Gestionnaire de configuration local décrites ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="d0990-111">The following lists the Local Configuration Manager properties that you can set or retrieve.</span></span>

- <span data-ttu-id="d0990-112">**AllowModuleOverwrite**  : indique si vous autorisez le remplacement des configurations existantes sur le nœud cible par de nouvelles configurations téléchargées du service de configuration.</span><span class="sxs-lookup"><span data-stu-id="d0990-112">**AllowModuleOverwrite** : Controls whether new configurations downloaded from the configuration service are allowed to overwrite the old ones on the target node.</span></span> <span data-ttu-id="d0990-113">Les valeurs possibles sont True et False.</span><span class="sxs-lookup"><span data-stu-id="d0990-113">Possible values are True and False.</span></span>
- <span data-ttu-id="d0990-114">**CertificateID**  : empreinte d’un certificat utilisée pour sécuriser les informations d’identification transmises dans une configuration.</span><span class="sxs-lookup"><span data-stu-id="d0990-114">**CertificateID** : The thumbprint of a certificate used to secure credentials passed in a configuration.</span></span> <span data-ttu-id="d0990-115">Pour plus d’informations, consultez [Sécuriser les informations d’identification dans DSC Windows PowerShell](https://devblogs.microsoft.com/powershell/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/).</span><span class="sxs-lookup"><span data-stu-id="d0990-115">For more information see [Want to secure credentials in Windows PowerShell Desired State Configuration?](https://devblogs.microsoft.com/powershell/want-to-secure-credentials-in-windows-powershell-desired-state-configuration/).</span></span>
- <span data-ttu-id="d0990-116">**ConfigurationID**  : indique le GUID utilisé pour obtenir un fichier de configuration spécifique d’un service d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d0990-116">**ConfigurationID** : Indicates a GUID which is used to get a particular configuration file from a pull service.</span></span> <span data-ttu-id="d0990-117">Le GUID permet d’identifier de façon unique le fichier de configuration à obtenir.</span><span class="sxs-lookup"><span data-stu-id="d0990-117">The GUID ensures that the correct configuration file is accessed.</span></span>
- <span data-ttu-id="d0990-118">**ConfigurationMode**  : spécifie de quelle façon le Gestionnaire de configuration local applique réellement la configuration aux nœuds cibles.</span><span class="sxs-lookup"><span data-stu-id="d0990-118">**ConfigurationMode** : Specifies how the Local Configuration Manager actually applies the configuration to the target nodes.</span></span> <span data-ttu-id="d0990-119">Il peut avoir les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="d0990-119">It can take the following values:</span></span>
  - <span data-ttu-id="d0990-120">**ApplyOnly**  : cette valeur indique à DSC d’appliquer la configuration et de ne faire aucune autre opération, sauf si vous transmettez une nouvelle configuration directement au nœud cible ou si vous vous connectez à un service d’extraction, et que DSC détecte une nouvelle configuration en interrogeant le service d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d0990-120">**ApplyOnly** : With this option, DSC applies the configuration and does nothing further unless a new configuration is detected, either by you sending a new configuration directly to the target node or if you are connecting to a pull service and DSC discovers a new configuration when it checks with the pull service.</span></span> <span data-ttu-id="d0990-121">Si la configuration du nœud cible diffère de la configuration initiale, aucune action particulière n’est effectuée.</span><span class="sxs-lookup"><span data-stu-id="d0990-121">If the target node's configuration drifts, no action is taken.</span></span>
  - <span data-ttu-id="d0990-122">**ApplyAndMonitor**  : cette valeur (valeur par défaut) indique à DSC d’appliquer chaque nouvelle configuration que vous avez transmise directement au nœud cible ou qui a été détectée sur un service d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d0990-122">**ApplyAndMonitor** : With this option (which is the default), DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span>
    <span data-ttu-id="d0990-123">Après l’application de la nouvelle configuration, si la configuration du nœud cible diffère du fichier de configuration, DSC signale l’écart dans les journaux.</span><span class="sxs-lookup"><span data-stu-id="d0990-123">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs.</span></span> <span data-ttu-id="d0990-124">Pour plus d’informations sur la journalisation de DSC, consultez [Utilisation des journaux des événements pour diagnostiquer les erreurs de configuration de l’état souhaité](https://devblogs.microsoft.com/powershell/using-event-logs-to-diagnose-errors-in-desired-state-configuration/).</span><span class="sxs-lookup"><span data-stu-id="d0990-124">For more about DSC logging, see [Using Event Logs to Diagnose Errors in Desired State Configuration](https://devblogs.microsoft.com/powershell/using-event-logs-to-diagnose-errors-in-desired-state-configuration/).</span></span>
  - <span data-ttu-id="d0990-125">**ApplyAndAutoCorrect**  : cette valeur indique à DSC d’appliquer chaque nouvelle configuration que vous avez transmise directement au nœud cible ou qui a été détectée sur un service d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d0990-125">**ApplyAndAutoCorrect** : With this option, DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="d0990-126">Après l’application de la nouvelle configuration, si la configuration du nœud cible diffère du fichier de configuration, DSC signale l’écart dans les journaux, puis tente de modifier la configuration du nœud cible pour la rendre conforme au fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="d0990-126">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs, and then attempts to adjust the target node configuration to bring in compliance with the configuration file.</span></span>
- <span data-ttu-id="d0990-127">**ConfigurationModeFrequencyMins**  : indique la fréquence (en minutes) à laquelle l’application en arrière-plan de DSC tente d’appliquer la configuration actuelle sur le nœud cible.</span><span class="sxs-lookup"><span data-stu-id="d0990-127">**ConfigurationModeFrequencyMins** : Represents the frequency (in minutes) at which the background application of DSC attempts to implement the current configuration on the target node.</span></span> <span data-ttu-id="d0990-128">La valeur par défaut est 15.</span><span class="sxs-lookup"><span data-stu-id="d0990-128">The default value is 15.</span></span> <span data-ttu-id="d0990-129">Cette valeur peut être définie conjointement avec RefreshMode.</span><span class="sxs-lookup"><span data-stu-id="d0990-129">This value can be set in conjunction with RefreshMode.</span></span> <span data-ttu-id="d0990-130">Quand la propriété RefreshMode est définie sur « Pull », le nœud cible interroge le service de configuration à la fréquence définie par RefreshFrequencyMins et télécharge la configuration actuelle.</span><span class="sxs-lookup"><span data-stu-id="d0990-130">When RefreshMode is set to PULL, the target node contacts the configuration service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="d0990-131">Quelle que soit la valeur de RefreshMode, le moteur de cohérence applique la dernière configuration téléchargée sur le nœud cible, à la fréquence définie par ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="d0990-131">Regardless of the RefreshMode value, at the interval set by ConfigurationModeFrequencyMins, the consistency engine applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="d0990-132">La valeur de RefreshFrequencyMins doit être un nombre entier multiple de la valeur de ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="d0990-132">RefreshFrequencyMins should be set to an integer multiple of ConfigurationModeFrequencyMins.</span></span>
- <span data-ttu-id="d0990-133">**Credential**  : indique les informations d’identification (comme avec Get-Credential) nécessaires pour accéder à des ressources distantes, par exemple, pour interroger le service de configuration.</span><span class="sxs-lookup"><span data-stu-id="d0990-133">**Credential** : Indicates credentials (as with Get-Credential) required to access remote resources, such as to contact the configuration service.</span></span>
- <span data-ttu-id="d0990-134">**DownloadManagerCustomData**  : désigne un tableau qui contient des données personnalisées spécifiques au Gestionnaire de téléchargement.</span><span class="sxs-lookup"><span data-stu-id="d0990-134">**DownloadManagerCustomData** : Represents an array that contains custom data specific to the download manager.</span></span>
- <span data-ttu-id="d0990-135">**DownloadManagerName**  : indique le nom du Gestionnaire de téléchargement des configurations et des modules.</span><span class="sxs-lookup"><span data-stu-id="d0990-135">**DownloadManagerName** : Indicates the name of the configuration and module download manager.</span></span>
- <span data-ttu-id="d0990-136">**RebootNodeIfNeeded**  : affectez la valeur `$true` pour autoriser les ressources à redémarrer le nœud à l’aide de l’indicateur `$global:DSCMachineStatus`.</span><span class="sxs-lookup"><span data-stu-id="d0990-136">**RebootNodeIfNeeded** : Set this to `$true` to allow resources to reboot the Node using the `$global:DSCMachineStatus` flag.</span></span> <span data-ttu-id="d0990-137">Sinon, vous devez redémarrer manuellement le nœud.</span><span class="sxs-lookup"><span data-stu-id="d0990-137">Otherwise, you will have to manually reboot the node for any configuration that requires it.</span></span> <span data-ttu-id="d0990-138">La valeur par défaut est `$false`.</span><span class="sxs-lookup"><span data-stu-id="d0990-138">The default value is `$false`.</span></span> <span data-ttu-id="d0990-139">Pour utiliser ce paramètre lorsqu’une condition de redémarrage est imposée par autre chose que DSC (par exemple Windows Installer), combinez ce paramètre avec le module [xPendingReboot](https://github.com/powershell/xpendingreboot).</span><span class="sxs-lookup"><span data-stu-id="d0990-139">To use this setting when a reboot condition is enacted by something other than DSC (such as Windows Installer), combine this setting with the [xPendingReboot](https://github.com/powershell/xpendingreboot) module.</span></span>
- <span data-ttu-id="d0990-140">**RefreshFrequencyMins**  : propriété à définir si vous avez configuré un service d’extraction.</span><span class="sxs-lookup"><span data-stu-id="d0990-140">**RefreshFrequencyMins** : Used when you have set up a pull service.</span></span> <span data-ttu-id="d0990-141">Elle indique la fréquence (en minutes) à laquelle le Gestionnaire de configuration local interroge un service d’extraction pour télécharger la configuration actuelle.</span><span class="sxs-lookup"><span data-stu-id="d0990-141">Represents the frequency (in minutes) at which the Local Configuration Manager contacts a pull service to download the current configuration.</span></span> <span data-ttu-id="d0990-142">Cette valeur peut être définie conjointement avec ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="d0990-142">This value can be set in conjunction with ConfigurationModeFrequencyMins.</span></span> <span data-ttu-id="d0990-143">Quand la propriété RefreshMode est définie sur « Pull », le nœud cible interroge le service d’extraction à la fréquence définie par RefreshFrequencyMins et télécharge la configuration actuelle.</span><span class="sxs-lookup"><span data-stu-id="d0990-143">When RefreshMode is set to PULL, the target node contacts the pull service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="d0990-144">À la fréquence définie par ConfigurationModeFrequencyMins, le moteur de cohérence applique ensuite la dernière configuration téléchargée sur le nœud cible.</span><span class="sxs-lookup"><span data-stu-id="d0990-144">At the interval set by ConfigurationModeFrequencyMins, the consistency engine then applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="d0990-145">Le système arrondit la valeur de RefreshFrequencyMins si elle n’est pas un nombre entier multiple de la valeur de ConfigurationModeFrequencyMins.</span><span class="sxs-lookup"><span data-stu-id="d0990-145">If RefreshFrequencyMins is not set to an integer multiple of ConfigurationModeFrequencyMins, the system will round it up.</span></span> <span data-ttu-id="d0990-146">La valeur par défaut est 30.</span><span class="sxs-lookup"><span data-stu-id="d0990-146">The default value is 30.</span></span>
- <span data-ttu-id="d0990-147">**RefreshMode**  : les valeurs possibles sont **Push** (valeur par défaut) et **Pull**.</span><span class="sxs-lookup"><span data-stu-id="d0990-147">**RefreshMode** : Possible values are **Push** (the default) and **Pull**.</span></span> <span data-ttu-id="d0990-148">Dans une configuration en mode « push », vous devez créer un fichier de configuration sur chaque nœud cible, avec n’importe quel ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="d0990-148">In the "push" configuration, you must place a configuration file on each target node, using any client computer.</span></span>
  <span data-ttu-id="d0990-149">En mode « pull », vous devez configurer un service de tirage (pull) que le Gestionnaire de configuration local peut interroger pour obtenir les fichiers de configuration.</span><span class="sxs-lookup"><span data-stu-id="d0990-149">In the "pull" mode, you must set up a pull service for Local Configuration Manager to contact and access the configuration files.</span></span>

> [!NOTE]
> <span data-ttu-id="d0990-150">Le Gestionnaire de configuration local démarre le cycle **ConfigurationModeFrequencyMins** d’après les critères suivants :</span><span class="sxs-lookup"><span data-stu-id="d0990-150">The LCM starts the **ConfigurationModeFrequencyMins** cycle based on:</span></span>
>
> - <span data-ttu-id="d0990-151">Une nouvelle métaconfiguration est appliquée à l’aide de `Set-DscLocalConfigurationManager`</span><span class="sxs-lookup"><span data-stu-id="d0990-151">A new metaconfig is applied using `Set-DscLocalConfigurationManager`</span></span>
> - <span data-ttu-id="d0990-152">Un redémarrage de l’ordinateur est effectué</span><span class="sxs-lookup"><span data-stu-id="d0990-152">A machine restart</span></span>
>
> <span data-ttu-id="d0990-153">Pour toute condition où le processus du minuteur plante, le problème est détecté dans les 30 secondes et le cycle est redémarré.</span><span class="sxs-lookup"><span data-stu-id="d0990-153">For any condition where the timer process experiences a crash, that will be detected within 30 seconds and the cycle will be restarted.</span></span> <span data-ttu-id="d0990-154">Une opération simultanée pourrait retarder le démarrage du cycle. Si la durée de cette opération dépasse la fréquence du cycle configurée, le minuteur suivant ne démarrera pas.</span><span class="sxs-lookup"><span data-stu-id="d0990-154">A concurrent operation could delay the cycle from being started, if the duration of this operation exceeds the configured cycle frequency, the next timer will not start.</span></span>
>
> <span data-ttu-id="d0990-155">Par exemple, la métaconfiguration est configurée à une fréquence d’extraction de 15 minutes et une opération d’extraction a lieu à T1.</span><span class="sxs-lookup"><span data-stu-id="d0990-155">Example, the metaconfig is configured at a 15 minute pull frequency and a pull occurs at T1.</span></span> <span data-ttu-id="d0990-156">Le nœud ne termine pas le travail avant 16 minutes.</span><span class="sxs-lookup"><span data-stu-id="d0990-156">The Node does not finish work for 16 minutes.</span></span> <span data-ttu-id="d0990-157">Le premier cycle de 15 minutes est ignoré, et l’extraction suivante aura lieu à T1+15+15.</span><span class="sxs-lookup"><span data-stu-id="d0990-157">The first 15 minute cycle is ignored, and next pull will happen at T1+15+15.</span></span>

### <a name="example-of-updating-local-configuration-manager-settings"></a><span data-ttu-id="d0990-158">Exemple de mise à jour des paramètres du Gestionnaire de configuration local</span><span class="sxs-lookup"><span data-stu-id="d0990-158">Example of updating Local Configuration Manager settings</span></span>

<span data-ttu-id="d0990-159">Pour mettre à jour les paramètres du Gestionnaire de configuration local d’un nœud cible, ajoutez un bloc **LocalConfigurationManager** au bloc du nœud dans un script de configuration, comme indiqué dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="d0990-159">You can update the Local Configuration Manager settings of a target node by including a **LocalConfigurationManager** block inside the node block in a configuration script, as shown in the following example.</span></span>

```powershell
Configuration ExampleConfig
{
    Node "Server001"
    {
        LocalConfigurationManager
        {
            ConfigurationID = "646e48cb-3082-4a12-9fd9-f71b9a562d4e"
            ConfigurationModeFrequencyMins = 45
            ConfigurationMode = "ApplyAndAutocorrect"
            RefreshMode = "Pull"
            RefreshFrequencyMins = 90
            DownloadManagerName = "WebDownloadManager"
            DownloadManagerCustomData = (@{ServerUrl="https://$PullService/psdscpullserver.svc"})
            CertificateID = "71AA68562316FE3F73536F1096B85D66289ED60E"
            Credential = $cred
            RebootNodeIfNeeded = $true
            AllowModuleOverwrite = $false
        }
# One or more resource blocks can be added here
    }
}

# The following line invokes the configuration and creates a file called
# Server001.meta.mof at the specified path
ExampleConfig -OutputPath "c:\users\public\dsc"
```

<span data-ttu-id="d0990-160">L’exécution du script dans l’exemple ci-dessus crée un fichier MOF qui spécifie et contient les paramètres souhaités.</span><span class="sxs-lookup"><span data-stu-id="d0990-160">Running the script in the previous example generates a MOF file that specifies and stores the desired settings.</span></span> <span data-ttu-id="d0990-161">Pour appliquer les paramètres, utilisez l’applet de commande **Set-DscLocalConfigurationManager** , comme dans l’exemple qui suit.</span><span class="sxs-lookup"><span data-stu-id="d0990-161">To apply the settings, you can use the **Set-DscLocalConfigurationManager** cmdlet, as shown in the following example.</span></span>

```powershell
Set-DscLocalConfigurationManager -Path "c:\users\public\dsc"
```

> [!NOTE]
> <span data-ttu-id="d0990-162">Pour le paramètre **Path** , vous devez spécifier le même chemin que celui que vous avez spécifié pour le paramètre **OutputPath** dans l’appel de la configuration de l’exemple précédent.</span><span class="sxs-lookup"><span data-stu-id="d0990-162">For the **Path** parameter, you must specify the same path that you specified for the **OutputPath** parameter when you invoked the configuration in the previous example.</span></span>

<span data-ttu-id="d0990-163">Pour afficher les paramètres actuels du Gestionnaire de configuration local, utilisez l’applet de commande **Get-DscLocalConfigurationManager**.</span><span class="sxs-lookup"><span data-stu-id="d0990-163">To see the current Local Configuration Manager settings, you can use the **Get-DscLocalConfigurationManager** cmdlet.</span></span> <span data-ttu-id="d0990-164">Si vous appelez cette applet de commande sans spécifier de paramètre, elle affiche par défaut les paramètres du Gestionnaire de configuration local pour le nœud sur lequel vous l’exécutez.</span><span class="sxs-lookup"><span data-stu-id="d0990-164">If you invoke this cmdlet with no parameters, by default it will get the Local Configuration Manager settings for the node on which you run it.</span></span> <span data-ttu-id="d0990-165">Pour spécifier un autre nœud, utilisez le paramètre **CimSession** avec cette applet de commande.</span><span class="sxs-lookup"><span data-stu-id="d0990-165">To specify another node, use the **CimSession** parameter with this cmdlet.</span></span>
