---
ms.date: 07/10/2019
keywords: jea,powershell,security
title: Capacités de rôle JEA
description: Une capacité de rôle est un fichier de données PowerShell avec l’extension .psrc qui liste toutes les applets de commande, toutes les fonctions, tous les fournisseurs et tous les programmes externes qui sont disponibles pour les utilisateurs qui se connectent.
ms.openlocfilehash: 233d9081f4a8f977f0959addb5573c4566f885d0
ms.sourcegitcommit: 9080316e3ca4f11d83067b41351531672b667b7a
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/24/2020
ms.locfileid: "92499992"
---
# <a name="jea-role-capabilities"></a><span data-ttu-id="8c9cd-104">Capacités de rôle JEA</span><span class="sxs-lookup"><span data-stu-id="8c9cd-104">JEA Role Capabilities</span></span>

<span data-ttu-id="8c9cd-105">Quand vous créez un point de terminaison JEA, vous devez définir une ou plusieurs capacités de rôle, qui décrivent ce que quelqu’un peut faire dans une session JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-105">When creating a JEA endpoint, you need to define one or more role capabilities that describe what someone can do in a JEA session.</span></span> <span data-ttu-id="8c9cd-106">Une capacité de rôle est un fichier de données PowerShell avec l’extension `.psrc` qui liste toutes les applets de commande, toutes les fonctions, tous les fournisseurs et tous les programmes externes qui sont disponibles pour les utilisateurs qui se connectent.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-106">A role capability is a PowerShell data file with the `.psrc` extension that lists all the cmdlets, functions, providers, and external programs that are made available to connecting users.</span></span>

## <a name="determine-which-commands-to-allow"></a><span data-ttu-id="8c9cd-107">Déterminer les commandes à autoriser</span><span class="sxs-lookup"><span data-stu-id="8c9cd-107">Determine which commands to allow</span></span>

<span data-ttu-id="8c9cd-108">La première étape de la création d’un fichier de capacités de rôle est de considérer ce à quoi les utilisateurs ont besoin d’accéder.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-108">The first step in creating a role capability file is to consider what the users need access to.</span></span> <span data-ttu-id="8c9cd-109">Ce processus de collecte de ce qui est nécessaire peut prendre un certain temps, mais il est très important.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-109">The requirements gathering process can take a while, but it's an important process.</span></span> <span data-ttu-id="8c9cd-110">En donnant accès aux utilisateurs à trop peu de fonctions et d’applets de commande, vous les empêchez de faire leur travail.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-110">Giving users access to too few cmdlets and functions can prevent them from getting their job done.</span></span> <span data-ttu-id="8c9cd-111">Autoriser l’accès à un trop grand nombre d’applets de commande et de fonctions peut permettre aux utilisateurs d’en faire plus que prévu et d’affaiblir la situation de votre sécurité.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-111">Allowing access to too many cmdlets and functions can allow users to do more than you intended and weaken your security stance.</span></span>

<span data-ttu-id="8c9cd-112">La façon dont vous allez procéder dépend de votre organisation et de vos objectifs.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-112">How you go about this process depends on your organization and goals.</span></span> <span data-ttu-id="8c9cd-113">Les conseils suivants peuvent vous aider à garantir que vous êtes sur la bonne voie.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-113">The following tips can help ensure you're on the right path.</span></span>

1. <span data-ttu-id="8c9cd-114">**Identifiez** les commandes que les utilisateurs emploient pour effectuer leur travail.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-114">**Identify** the commands users are using to get their jobs done.</span></span> <span data-ttu-id="8c9cd-115">Ceci peut impliquer d’observer le personnel informatique, de consulter les scripts d’automatisation, ou d’analyser les journaux et les transcriptions des sessions PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-115">This may involve surveying IT staff, checking automation scripts, or analyzing PowerShell session transcripts and logs.</span></span>
2. <span data-ttu-id="8c9cd-116">**Transposez** l’utilisation des outils de ligne de commande en leurs équivalents PowerShell là où c’est possible, pour assurer la meilleure expérience d’audit et de personnalisation de JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-116">**Update** use of command-line tools to PowerShell equivalents, where possible, for the best auditing and JEA customization experience.</span></span> <span data-ttu-id="8c9cd-117">Les programmes externes ne peuvent pas avoir de contraintes aussi granulaires que les fonctions et applets de commande PowerShell natives dans JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-117">External programs can't be constrained as granularly as native PowerShell cmdlets and functions in JEA.</span></span>
3. <span data-ttu-id="8c9cd-118">**Restreignez** l’étendue des applets de commande en autorisant seulement des paramètres ou des valeurs de paramètres spécifiques.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-118">**Restrict** the scope of the cmdlets to only allow specific parameters or parameter values.</span></span> <span data-ttu-id="8c9cd-119">Ceci est particulièrement important si les utilisateurs doivent gérer seulement une partie d’un système.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-119">This is especially important if users should manage only part of a system.</span></span>
4. <span data-ttu-id="8c9cd-120">**Créez** des fonctions personnalisées pour remplacer des commandes complexes ou difficiles à contraindre dans JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-120">**Create** custom functions to replace complex commands or commands that are difficult to constrain in JEA.</span></span> <span data-ttu-id="8c9cd-121">Une fonction simple qui inclut une commande complexe dans un wrapper ou applique une logique de validation supplémentaire peut offrir des contrôles supplémentaires aux administrateurs et plus de simplicité aux utilisateurs finaux.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-121">A simple function that wraps a complex command or applies additional validation logic can offer additional control for admins and end-user simplicity.</span></span>
5. <span data-ttu-id="8c9cd-122">**Testez** la liste délimitée des commandes admissibles avec vos utilisateurs et/ou vos services d’automatisation, et effectuez les ajustements nécessaires.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-122">**Test** the scoped list of allowable commands with your users or automation services, and adjust as necessary.</span></span>

### <a name="examples-of-potentially-dangerous-commands"></a><span data-ttu-id="8c9cd-123">Exemples de commandes potentiellement dangereuses</span><span class="sxs-lookup"><span data-stu-id="8c9cd-123">Examples of potentially dangerous commands</span></span>

<span data-ttu-id="8c9cd-124">Une sélection rigoureuse des commandes est essentielle pour que le point de terminaison JEA ne permette pas à l’utilisateur connecté d’élever ses autorisations.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-124">Careful selection of commands is important to ensure the JEA endpoint doesn't allow the user to elevate their permissions.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8c9cd-125">Informations essentielles nécessaires pour tout fonctionne bien pour l’utilisateur Dans une session JEA, les commandes sont souvent exécutées avec des privilèges élevés.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-125">Essential information required for user successCommands in a JEA session are often run with elevated privileges.</span></span>

<span data-ttu-id="8c9cd-126">Le tableau suivant contient des exemples de commandes qui peuvent être utilisées à des fins malveillantes si elles sont autorisées sans contraintes.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-126">The following table contains examples of commands that can be used maliciously if allowed in an unconstrained state.</span></span> <span data-ttu-id="8c9cd-127">Cette liste n’est pas exhaustive et ne doit être utilisée que comme point de départ pour prendre les précautions qui s’imposent.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-127">This isn't an exhaustive list and should only be used as a cautionary starting point.</span></span>

|                                            <span data-ttu-id="8c9cd-128">Risque</span><span class="sxs-lookup"><span data-stu-id="8c9cd-128">Risk</span></span>                                            |                                <span data-ttu-id="8c9cd-129">Exemple</span><span class="sxs-lookup"><span data-stu-id="8c9cd-129">Example</span></span>                                |                                                                              <span data-ttu-id="8c9cd-130">Commandes associées</span><span class="sxs-lookup"><span data-stu-id="8c9cd-130">Related commands</span></span>                                                                              |
| ------------------------------------------------------------------------------------------ | --------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="8c9cd-131">Accorder des privilèges Administrateur à l’utilisateur connecté pour contourner JEA</span><span class="sxs-lookup"><span data-stu-id="8c9cd-131">Granting the connecting user admin privileges to bypass JEA</span></span>                                | `Add-LocalGroupMember -Member 'CONTOSO\jdoe' -Group 'Administrators'` | <span data-ttu-id="8c9cd-132">`Add-ADGroupMember`, `Add-LocalGroupMember`, `net.exe`, `dsadd.exe`</span><span class="sxs-lookup"><span data-stu-id="8c9cd-132">`Add-ADGroupMember`, `Add-LocalGroupMember`, `net.exe`, `dsadd.exe`</span></span>                                                                                                        |
| <span data-ttu-id="8c9cd-133">Exécuter du code arbitraire, notamment des logiciels malveillants, du code malveillant exploitant une faille de sécurité ou des scripts personnalisés afin de contourner les protections</span><span class="sxs-lookup"><span data-stu-id="8c9cd-133">Running arbitrary code, such as malware, exploits, or custom scripts to bypass protections</span></span> | `Start-Process -FilePath '\\san\share\malware.exe'`                   | <span data-ttu-id="8c9cd-134">`Start-Process`, `New-Service`, `Invoke-Item`, `Invoke-WmiMethod`, `Invoke-CimMethod`, `Invoke-Expression`, `Invoke-Command`, `New-ScheduledTask`, `Register-ScheduledJob`</span><span class="sxs-lookup"><span data-stu-id="8c9cd-134">`Start-Process`, `New-Service`, `Invoke-Item`, `Invoke-WmiMethod`, `Invoke-CimMethod`, `Invoke-Expression`, `Invoke-Command`, `New-ScheduledTask`, `Register-ScheduledJob`</span></span> |

## <a name="create-a-role-capability-file"></a><span data-ttu-id="8c9cd-135">Créer un fichier de capacités de rôle</span><span class="sxs-lookup"><span data-stu-id="8c9cd-135">Create a role capability file</span></span>

<span data-ttu-id="8c9cd-136">Vous pouvez créer un fichier de capacités de rôle PowerShell avec l’applet de commande [New-PSRoleCapabilityFile](/powershell/module/microsoft.powershell.core/new-psrolecapabilityfile).</span><span class="sxs-lookup"><span data-stu-id="8c9cd-136">You can create a new PowerShell role capability file with the [New-PSRoleCapabilityFile](/powershell/module/microsoft.powershell.core/new-psrolecapabilityfile) cmdlet.</span></span>

```powershell
New-PSRoleCapabilityFile -Path .\MyFirstJEARole.psrc
```

<span data-ttu-id="8c9cd-137">Le fichier de capacités de rôle qui en résulte doit être modifié pour autoriser les commandes nécessaires pour le rôle.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-137">The resulting role capability file should be edited to allow the commands required for the role.</span></span> <span data-ttu-id="8c9cd-138">La documentation d’aide PowerShell contient plusieurs exemples de configuration du fichier.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-138">The PowerShell help documentation contains several examples of how you can configure the file.</span></span>

### <a name="allowing-powershell-cmdlets-and-functions"></a><span data-ttu-id="8c9cd-139">Autoriser les fonctions et les applets de commande PowerShell</span><span class="sxs-lookup"><span data-stu-id="8c9cd-139">Allowing PowerShell cmdlets and functions</span></span>

<span data-ttu-id="8c9cd-140">Pour autoriser les utilisateurs à exécuter des fonctions ou des applets de commande PowerShell, ajoutez le nom de l’applet de commande ou de la fonction au champ VisibleFunctions ou VisibleFunctions.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-140">To authorize users to run PowerShell cmdlets or functions, add the cmdlet or function name to the VisibleCmdlets or VisibleFunctions fields.</span></span> <span data-ttu-id="8c9cd-141">Si vous ne savez pas si une commande est une applet de commande ou une fonction, vous pouvez exécuter `Get-Command <name>` et vérifier la propriété **CommandType** dans la sortie.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-141">If you aren't sure whether a command is a cmdlet or function, you can run `Get-Command <name>` and check the **CommandType** property in the output.</span></span>

```powershell
VisibleCmdlets = 'Restart-Computer', 'Get-NetIPAddress'
```

<span data-ttu-id="8c9cd-142">La portée d’une applet de commande ou d’une fonction donnée est parfois trop vaste pour les besoins de vos utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-142">Sometimes the scope of a specific cmdlet or function is too broad for your users' needs.</span></span> <span data-ttu-id="8c9cd-143">Un administrateur DNS, par exemple, n’a probablement besoin que de l’accès nécessaire pour redémarrer le service DNS.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-143">A DNS admin, for example, probably only needs access to restart the DNS service.</span></span> <span data-ttu-id="8c9cd-144">Dans les environnements multilocataire, les locataires ont accès aux outils de gestion en libre-service.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-144">In multi-tenant environments, tenants have access to self-service management tools.</span></span> <span data-ttu-id="8c9cd-145">Ils doivent être limités à la gestion de leurs propres ressources.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-145">Tenants should be limited to managing their own resources.</span></span> <span data-ttu-id="8c9cd-146">Dans ce cas, vous pouvez restreindre les paramètres exposés à partir de l’applet de commande ou de la fonction.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-146">For these cases, you can restrict which parameters are exposed from the cmdlet or function.</span></span>

```powershell
VisibleCmdlets = @{ Name = 'Restart-Computer'; Parameters = @{ Name = 'Name' }}
```

<span data-ttu-id="8c9cd-147">Dans des scénarios plus avancés, il peut également être nécessaire de restreindre les valeurs que les utilisateurs peuvent utiliser avec ces paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-147">In more advanced scenarios, you may also need to restrict the values a user may use with these parameters.</span></span> <span data-ttu-id="8c9cd-148">Les capacités de rôle vous permettent de définir un ensemble de valeurs ou un modèle d’expression régulière qui déterminent si une entrée est autorisée.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-148">Role capabilities let you define a set of values or a regular expression pattern that determine what input is allowed.</span></span>

```powershell
VisibleCmdlets = @{ Name = 'Restart-Service'; Parameters = @{ Name = 'Name'; ValidateSet = 'Dns', 'Spooler' }},
                 @{ Name = 'Start-Website'; Parameters = @{ Name = 'Name'; ValidatePattern = 'HR_*' }}
```

> [!NOTE]
> <span data-ttu-id="8c9cd-149">Les [paramètres PowerShell communs](/powershell/module/microsoft.powershell.core/about/about_commonparameters) sont toujours autorisés, même si vous limitez les paramètres disponibles.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-149">The [common PowerShell parameters](/powershell/module/microsoft.powershell.core/about/about_commonparameters) are always allowed, even if you restrict the available parameters.</span></span>
> <span data-ttu-id="8c9cd-150">Vous ne devez pas les lister explicitement dans le champ Paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-150">You should not explicitly list them in the Parameters field.</span></span>

<span data-ttu-id="8c9cd-151">Le tableau ci-dessous décrit les différentes façons de personnaliser une fonction ou une applet de commande visible.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-151">The table below describes the various ways you can customize a visible cmdlet or function.</span></span>
<span data-ttu-id="8c9cd-152">Vous pouvez associer les méthodes suivantes comme vous le souhaitez dans le champ **VisibleCmdlets** .</span><span class="sxs-lookup"><span data-stu-id="8c9cd-152">You can mix and match any of the below in the **VisibleCmdlets** field.</span></span>

|                                           <span data-ttu-id="8c9cd-153">Exemple</span><span class="sxs-lookup"><span data-stu-id="8c9cd-153">Example</span></span>                                           |                                                             <span data-ttu-id="8c9cd-154">Cas d’utilisation</span><span class="sxs-lookup"><span data-stu-id="8c9cd-154">Use case</span></span>                                                              |
| ------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="8c9cd-155">`'My-Func'` ou `@{ Name = 'My-Func' }`</span><span class="sxs-lookup"><span data-stu-id="8c9cd-155">`'My-Func'` or `@{ Name = 'My-Func' }`</span></span>                                                      | <span data-ttu-id="8c9cd-156">Permet à l’utilisateur d’exécuter `My-Func` sans aucune restriction sur les paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-156">Allows the user to run `My-Func` without any restrictions on the parameters.</span></span>                                                      |
| `'MyModule\My-Func'`                                                                        | <span data-ttu-id="8c9cd-157">Permet à l’utilisateur d’exécuter `My-Func` à partir du module `MyModule` sans aucune restriction sur les paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-157">Allows the user to run `My-Func` from the module `MyModule` without any restrictions on the parameters.</span></span>                           |
| `'My-*'`                                                                                    | <span data-ttu-id="8c9cd-158">Permet à l’utilisateur d’exécuter toutes les applets de commande ou fonctions avec le verbe `My`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-158">Allows the user to run any cmdlet or function with the verb `My`.</span></span>                                                                 |
| `'*-Func'`                                                                                  | <span data-ttu-id="8c9cd-159">Permet à l’utilisateur d’exécuter toutes les applets de commande ou fonctions avec le nom `Func`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-159">Allows the user to run any cmdlet or function with the noun `Func`.</span></span>                                                               |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'}, @{ Name = 'Param2' }}`              | <span data-ttu-id="8c9cd-160">Permet à l’utilisateur d’exécuter `My-Func` avec les paramètres `Param1` et `Param2`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-160">Allows the user to run `My-Func` with the `Param1` and `Param2` parameters.</span></span> <span data-ttu-id="8c9cd-161">Toutes les valeurs peuvent être transmises aux paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-161">Any value can be supplied to the parameters.</span></span>          |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'; ValidateSet = 'Value1', 'Value2' }}` | <span data-ttu-id="8c9cd-162">Permet à l’utilisateur d’exécuter `My-Func` avec le paramètre `Param1`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-162">Allows the user to run `My-Func` with the `Param1` parameter.</span></span> <span data-ttu-id="8c9cd-163">Seules les valeurs « Value1 » et « Value2 » peuvent être transmises au paramètre.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-163">Only "Value1" and "Value2" can be supplied to the parameter.</span></span>        |
| `@{ Name = 'My-Func'; Parameters = @{ Name = 'Param1'; ValidatePattern = 'contoso.*' }}`    | <span data-ttu-id="8c9cd-164">Permet à l’utilisateur d’exécuter `My-Func` avec le paramètre `Param1`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-164">Allows the user to run `My-Func` with the `Param1` parameter.</span></span> <span data-ttu-id="8c9cd-165">Toutes les valeurs commençant par « contoso » peuvent être transmises au paramètre.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-165">Any value starting with "contoso" can be supplied to the parameter.</span></span> |

> [!WARNING]
> <span data-ttu-id="8c9cd-166">Les meilleures pratiques de sécurité déconseillent d’utiliser des caractères génériques pour définir des fonctions ou des applets de commande visibles.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-166">For best security practices, it is not recommended to use wildcards when defining visible cmdlets or functions.</span></span> <span data-ttu-id="8c9cd-167">Au contraire, listez explicitement chaque commande approuvée de façon qu’aucune autre commande partageant le même schéma d’affectation de noms ne soit autorisée par inadvertance.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-167">Instead, you should explicitly list each trusted command to ensure no other commands that share the same naming scheme are unintentionally authorized.</span></span>

<span data-ttu-id="8c9cd-168">Vous ne pouvez pas appliquer à la fois un **ValidatePattern** et un **ValidateSet** à la même applet de commande ou la même fonction.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-168">You can't apply both a **ValidatePattern** and **ValidateSet** to the same cmdlet or function.</span></span>

<span data-ttu-id="8c9cd-169">Si vous le faites, le **ValidatePattern** l’emporte sur le **ValidateSet** .</span><span class="sxs-lookup"><span data-stu-id="8c9cd-169">If you do, the **ValidatePattern** overrides the **ValidateSet** .</span></span>

<span data-ttu-id="8c9cd-170">Pour plus d’informations sur **ValidatePattern** , consultez [ce billet *Hey, Scripting Guy!* ](https://devblogs.microsoft.com/scripting/validate-powershell-parameters-before-running-the-script/) et le contenu de référence de [Expressions régulières PowerShell](/powershell/module/microsoft.powershell.core/about/about_regular_expressions).</span><span class="sxs-lookup"><span data-stu-id="8c9cd-170">For more information about **ValidatePattern** , check out [this *Hey, Scripting Guy!* post](https://devblogs.microsoft.com/scripting/validate-powershell-parameters-before-running-the-script/) and the [PowerShell Regular Expressions](/powershell/module/microsoft.powershell.core/about/about_regular_expressions) reference content.</span></span>

### <a name="allowing-external-commands-and-powershell-scripts"></a><span data-ttu-id="8c9cd-171">Autoriser des commandes externes et des scripts PowerShell</span><span class="sxs-lookup"><span data-stu-id="8c9cd-171">Allowing external commands and PowerShell scripts</span></span>

<span data-ttu-id="8c9cd-172">Pour permettre aux utilisateurs de lancer des exécutables et des scripts PowerShell (.ps1) dans une session JEA, vous devez ajouter le chemin complet de chaque programme dans le champ **VisibleExternalCommands** .</span><span class="sxs-lookup"><span data-stu-id="8c9cd-172">To allow users to run executables and PowerShell scripts (.ps1) in a JEA session, you have to add the full path to each program in the **VisibleExternalCommands** field.</span></span>

```powershell
VisibleExternalCommands = 'C:\Windows\System32\whoami.exe', 'C:\Program Files\Contoso\Scripts\UpdateITSoftware.ps1'
```

<span data-ttu-id="8c9cd-173">Là où c’est possible, utilisez des applets de commande/fonctions PowerShell équivalentes pour les exécutables externes que vous autorisez, car vous contrôlez les paramètres autorisés avec les applets de commande et les fonctions PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-173">Where possible, to use PowerShell cmdlet or function equivalents for any external executables you authorize since you have control over the parameters allowed with PowerShell cmdlets and functions.</span></span>

<span data-ttu-id="8c9cd-174">De nombreux exécutables permettent de lire l’état actuel, puis de le modifier en fournissant d’autres paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-174">Many executables allow you to read the current state and then change it by providing different parameters.</span></span>

<span data-ttu-id="8c9cd-175">Par exemple, considérez le rôle d’administrateur de serveur de fichiers qui gère des partages réseau hébergés sur un système.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-175">For example, consider the role of a file server admin that manages network shares hosted on a system.</span></span> <span data-ttu-id="8c9cd-176">Une façon de gérer les partages est d’utiliser `net share`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-176">One way of managing shares is to use `net share`.</span></span> <span data-ttu-id="8c9cd-177">Cependant, autoriser **net.exe** est dangereux, car l’administrateur pourrait utiliser la commande pour obtenir des privilèges d’administration avec `net group Administrators unprivilegedjeauser /add`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-177">However, allowing **net.exe** is dangerous because the user could use the command to gain admin privileges with `net group Administrators unprivilegedjeauser /add`.</span></span> <span data-ttu-id="8c9cd-178">Une option plus sécurisée est d’autoriser [Get-SmbShare](/powershell/module/smbshare/get-smbshare), qui donne le même résultat, mais a une étendue bien plus limitée.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-178">A more secure option is to allow [Get-SmbShare](/powershell/module/smbshare/get-smbshare), which achieves the same result but has a much more limited scope.</span></span>

<span data-ttu-id="8c9cd-179">Quand vous rendez des commandes externes disponibles pour les utilisateurs dans une session JEA, spécifiez toujours le chemin complet du fichier exécutable.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-179">When making external commands available to users in a JEA session, always specify the complete path to the executable.</span></span> <span data-ttu-id="8c9cd-180">Ceci empêche l’exécution de programmes potentiellement malveillants portant le même nom et situés ailleurs dans le système.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-180">This prevents the execution of similarly named and potentially malicious programs located elsewhere on the system.</span></span>

### <a name="allowing-access-to-powershell-providers"></a><span data-ttu-id="8c9cd-181">Autoriser l’accès aux fournisseurs PowerShell</span><span class="sxs-lookup"><span data-stu-id="8c9cd-181">Allowing access to PowerShell providers</span></span>

<span data-ttu-id="8c9cd-182">Par défaut, les fournisseurs PowerShell sont disponibles dans les sessions JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-182">By default, no PowerShell providers are available in JEA sessions.</span></span> <span data-ttu-id="8c9cd-183">Ceci réduit le risque de divulgation d’informations sensibles et de paramètres de configuration à l’utilisateur qui se connecte.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-183">This reduces the risk of sensitive information and configuration settings being disclosed to the connecting user.</span></span>

<span data-ttu-id="8c9cd-184">Si nécessaire, vous pouvez autoriser l’accès aux fournisseurs de PowerShell à l’aide de la commande `VisibleProviders`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-184">When necessary, you can allow access to the PowerShell providers using the `VisibleProviders` command.</span></span> <span data-ttu-id="8c9cd-185">Pour obtenir la liste complète des fournisseurs, exécutez `Get-PSProvider`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-185">For a full list of providers, run `Get-PSProvider`.</span></span>

```powershell
VisibleProviders = 'Registry'
```

<span data-ttu-id="8c9cd-186">Pour des tâches simples qui nécessitent l’accès au système de fichiers, au Registre, au magasin de certificats ou à d’autres fournisseurs sensibles, envisagez d’écrire une fonction personnalisée qui fonctionne avec le fournisseur pour le compte de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-186">For simple tasks that require access to the file system, registry, certificate store, or other sensitive providers, consider writing a custom function that works with the provider on the user's behalf.</span></span> <span data-ttu-id="8c9cd-187">Les fonctions, applets de commande et programmes externes disponibles dans une session JEA ne sont pas soumis aux mêmes contraintes que JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-187">The functions, cmdlets, and external programs available in a JEA session aren't subject to the same constraints as JEA.</span></span> <span data-ttu-id="8c9cd-188">Ils peuvent accéder à tous les fournisseurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-188">They can access any provider by default.</span></span> <span data-ttu-id="8c9cd-189">Envisagez également d’utiliser le [lecteur utilisateur](session-configurations.md#user-drive) quand la copie de fichiers vers/depuis un point de terminaison JEA est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-189">Also consider using the [user drive](session-configurations.md#user-drive) when copying files to or from a JEA endpoint is required.</span></span>

### <a name="creating-custom-functions"></a><span data-ttu-id="8c9cd-190">Créer des fonctions personnalisées</span><span class="sxs-lookup"><span data-stu-id="8c9cd-190">Creating custom functions</span></span>

<span data-ttu-id="8c9cd-191">Vous pouvez créer des fonctions personnalisées dans un fichier de capacités de rôle pour simplifier les tâches complexes de vos utilisateurs finaux.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-191">You can author custom functions in a role capability file to simplify complex tasks for your end users.</span></span> <span data-ttu-id="8c9cd-192">Les fonctions personnalisées sont également utiles lorsque vous avez besoin d’une logique de validation avancée pour les valeurs de paramètres des applets de commande.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-192">Custom functions are also useful when you require advanced validation logic for cmdlet parameter values.</span></span> <span data-ttu-id="8c9cd-193">Vous pouvez écrire des fonctions simples dans le champ **FunctionDefinitions** :</span><span class="sxs-lookup"><span data-stu-id="8c9cd-193">You can write simple functions in the **FunctionDefinitions** field:</span></span>

```powershell
VisibleFunctions = 'Get-TopProcess'

FunctionDefinitions = @{
    Name = 'Get-TopProcess'

    ScriptBlock = {
        param($Count = 10)

        Get-Process | Sort-Object -Property CPU -Descending |
            Microsoft.PowerShell.Utility\Select-Object -First $Count
    }
}
```

> [!IMPORTANT]
> <span data-ttu-id="8c9cd-194">N’oubliez pas d’ajouter le nom de vos fonctions personnalisées au champ **VisibleFunctions** pour qu’elles puissent être exécutées par les utilisateurs JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-194">Don't forget to add the name of your custom functions to the **VisibleFunctions** field so they can be run by the JEA users.</span></span>

<span data-ttu-id="8c9cd-195">Le corps (bloc de script) des fonctions personnalisées s’exécute dans le mode de langage par défaut du système et n’est pas soumis aux contraintes de langage de JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-195">The body (script block) of custom functions runs in the default language mode for the system and isn't subject to JEA's language constraints.</span></span> <span data-ttu-id="8c9cd-196">Cela signifie que les fonctions peuvent accéder au système de fichiers et au Registre, et exécuter des commandes qui n’étaient pas visibles dans le fichier de capacités de rôle.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-196">This means that functions can access the file system and registry, and run commands that weren't made visible in the role capability file.</span></span> <span data-ttu-id="8c9cd-197">Prenez soin d’éviter l’exécution de code arbitraire lors de l’utilisation de paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-197">Take care to avoid running arbitrary code when using parameters.</span></span> <span data-ttu-id="8c9cd-198">Évitez de transférer une entrée utilisateur via un canal directement dans des applets de commande comme `Invoke-Expression`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-198">Avoid piping user input directly into cmdlets like `Invoke-Expression`.</span></span>

<span data-ttu-id="8c9cd-199">Dans l’exemple ci-dessus, notez que le nom du module complet (FQMN) `Microsoft.PowerShell.Utility\Select-Object` a été utilisé à la place du nom raccourci `Select-Object`.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-199">In the above example, notice that the fully qualified module name (FQMN) `Microsoft.PowerShell.Utility\Select-Object` was used instead of the shorthand `Select-Object`.</span></span>
<span data-ttu-id="8c9cd-200">Les fonctions définies dans les fichiers de capacités de rôle sont toujours soumises à la portée des sessions JEA, qui comprend les fonctions de proxy créées par JEA pour contraindre les commandes existantes.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-200">Functions defined in role capability files are still subject to the scope of JEA sessions, which includes the proxy functions JEA creates to constrain existing commands.</span></span>

<span data-ttu-id="8c9cd-201">Par défaut, `Select-Object` est une applet de commande contrainte dans toutes les sessions JEA, qui ne vous permet pas la sélection de propriétés arbitraires sur des objets.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-201">By default, `Select-Object` is a constrained cmdlet in all JEA sessions that doesn't allow the selection of arbitrary properties on objects.</span></span> <span data-ttu-id="8c9cd-202">Pour utiliser `Select-Object` sans contraintes dans les fonctions, vous devez demander explicitement l’implémentation complète en spécifiant le nom du module complet.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-202">To use the unconstrained `Select-Object` in functions, you must explicitly request the full implementation using the FQMN.</span></span> <span data-ttu-id="8c9cd-203">Une applet de commande contrainte dans une session JEA a les mêmes contraintes que quand elle est appelée à partir d’une fonction.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-203">Any constrained cmdlet in a JEA session has the same constraints when invoked from a function.</span></span> <span data-ttu-id="8c9cd-204">Pour plus d’informations, consultez [about_Command_Precedence](/powershell/module/microsoft.powershell.core/about/about_command_precedence).</span><span class="sxs-lookup"><span data-stu-id="8c9cd-204">For more information, see [about_Command_Precedence](/powershell/module/microsoft.powershell.core/about/about_command_precedence).</span></span>

<span data-ttu-id="8c9cd-205">Si vous écrivez de nombreuses fonctions personnalisées, il peut être plus pratique de les placer dans un module de script PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-205">If you're writing several custom functions, it's more convenient to put them in a PowerShell script module.</span></span> <span data-ttu-id="8c9cd-206">Vous rendez ces fonctions visibles dans la session JEA en utilisant le champ **VisibleFunctions** , comme avec des modules intégrés et de tiers.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-206">You make those functions visible in the JEA session using the **VisibleFunctions** field like you would with built-in and third-party modules.</span></span>

<span data-ttu-id="8c9cd-207">Pour que la complétion avec la touche TAB fonctionne correctement dans les sessions JEA, vous devez inclure la fonction intégrée `tabexpansion2` dans la liste **VisibleFunctions** .</span><span class="sxs-lookup"><span data-stu-id="8c9cd-207">For tab completion to work properly in JEA sessions you must include the built-in function `tabexpansion2` in the **VisibleFunctions** list.</span></span>

## <a name="make-the-role-capabilities-available-to-a-configuration"></a><span data-ttu-id="8c9cd-208">Rendre les fonctionnalités de rôle disponibles pour une configuration</span><span class="sxs-lookup"><span data-stu-id="8c9cd-208">Make the role capabilities available to a configuration</span></span>

<span data-ttu-id="8c9cd-209">Avant PowerShell 6, pour que PowerShell trouve un fichier de capacités de rôle, celui-ci doit être stocké dans le dossier **RoleCapabilities** d’un module PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-209">Prior to PowerShell 6, for PowerShell to find a role capability file it must be stored in a **RoleCapabilities** folder in a PowerShell module.</span></span> <span data-ttu-id="8c9cd-210">Le module peut être stocké dans un dossier inclus dans la variable d’environnement `$env:PSModulePath` ; cependant, vous ne devez pas le placer dans `$env:SystemRoot\System32` ou dans un dossier où des utilisateurs non fiables pourraient modifier les fichiers.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-210">The module can be stored in any folder included in the `$env:PSModulePath` environment variable, however you shouldn't place it in `$env:SystemRoot\System32` or a folder where untrusted users could modify the files.</span></span>

<span data-ttu-id="8c9cd-211">L’exemple suivant crée un module de script PowerShell appelé **ContosoJEA** dans le chemin `$env:ProgramFiles` pour héberger le fichier de capacités de rôle.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-211">The following example creates a PowerShell script module called **ContosoJEA** in the `$env:ProgramFiles` path to host the role capabilities file.</span></span>

```powershell
# Create a folder for the module
$modulePath = Join-Path $env:ProgramFiles "WindowsPowerShell\Modules\ContosoJEA"
New-Item -ItemType Directory -Path $modulePath

# Create an empty script module and module manifest.
# At least one file in the module folder must have the same name as the folder itself.
New-Item -ItemType File -Path (Join-Path $modulePath "ContosoJEAFunctions.psm1")
New-ModuleManifest -Path (Join-Path $modulePath "ContosoJEA.psd1") -RootModule "ContosoJEAFunctions.psm1"

# Create the RoleCapabilities folder and copy in the PSRC file
$rcFolder = Join-Path $modulePath "RoleCapabilities"
New-Item -ItemType Directory $rcFolder
Copy-Item -Path .\MyFirstJEARole.psrc -Destination $rcFolder
```

<span data-ttu-id="8c9cd-212">Pour plus d’informations sur les modules PowerShell, consultez [Comprendre un module PowerShell](/powershell/scripting/developer/windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="8c9cd-212">For more information about PowerShell modules, see [Understanding a PowerShell Module](/powershell/scripting/developer/windows-powershell).</span></span>

<span data-ttu-id="8c9cd-213">À compter de PowerShell 6, la propriété **RoleDefinitions** a été ajoutée au fichier de configuration de session.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-213">Starting in PowerShell 6, the **RoleDefinitions** property was added to the session configuration file.</span></span> <span data-ttu-id="8c9cd-214">Cette propriété vous permet de spécifier l’emplacement d’un fichier de configuration de rôle pour votre définition de rôle.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-214">This property lets you specify the location of a role configuration file for your role definition.</span></span> <span data-ttu-id="8c9cd-215">Consultez les exemples dans [New-PSSessionConfigurationFile](/powershell/module/microsoft.powershell.core/new-pssessionconfigurationfile).</span><span class="sxs-lookup"><span data-stu-id="8c9cd-215">See the examples in [New-PSSessionConfigurationFile](/powershell/module/microsoft.powershell.core/new-pssessionconfigurationfile).</span></span>

## <a name="updating-role-capabilities"></a><span data-ttu-id="8c9cd-216">Mettre à jour les capacités de rôle</span><span class="sxs-lookup"><span data-stu-id="8c9cd-216">Updating role capabilities</span></span>

<span data-ttu-id="8c9cd-217">Vous pouvez modifier à tout moment un fichier de capacités de rôle pour mettre à jour les paramètres.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-217">You can edit a role capability file to update the settings at any time.</span></span> <span data-ttu-id="8c9cd-218">Les nouvelles sessions JEA lancées après la mise à jour de la capacité du rôle reflèteront les fonctionnalités modifiées.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-218">Any new JEA sessions started after the role capability has been updated will reflect the revised capabilities.</span></span>

<span data-ttu-id="8c9cd-219">C’est pourquoi il est très important de contrôler l’accès au dossier de capacités de rôle.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-219">This is why controlling access to the role capabilities folder is so important.</span></span> <span data-ttu-id="8c9cd-220">Seuls les administrateurs approuvés doivent pouvoir modifier les fichiers de capacités de rôle.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-220">Only highly trusted administrators should be allowed to change role capability files.</span></span> <span data-ttu-id="8c9cd-221">Si un utilisateur non approuvé peut modifier les fichiers de capacités de rôle, il peut facilement s’accorder l’accès aux applets de commande qui lui permettent d’élever ses privilèges.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-221">If an untrusted user can change role capability files, they can easily give themselves access to cmdlets that allow them to elevate their privileges.</span></span>

<span data-ttu-id="8c9cd-222">Les administrateurs qui souhaitent verrouiller l’accès aux capacités de rôle doivent vérifier que le système local a un accès en lecture aux fichiers de capacités de rôle et aux modules qui les contiennent.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-222">For administrators looking to lock down access to the role capabilities, ensure Local System has read access to the role capability files and containing modules.</span></span>

## <a name="how-role-capabilities-are-merged"></a><span data-ttu-id="8c9cd-223">Fusionner les capacités de rôle</span><span class="sxs-lookup"><span data-stu-id="8c9cd-223">How role capabilities are merged</span></span>

<span data-ttu-id="8c9cd-224">Les utilisateurs sont autorisés à accéder à toutes les capacités de rôle correspondantes dans le [fichier de configuration de session](session-configurations.md) quand ils entrent dans une session JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-224">Users are granted access to all matching role capabilities in the [session configuration file](session-configurations.md) when they enter a JEA session.</span></span> <span data-ttu-id="8c9cd-225">JEA tente de donner à l’utilisateur l’ensemble de commandes le plus permissif autorisé par les rôles.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-225">JEA tries to give the user the most permissive set of commands allowed by any of the roles.</span></span>

### <a name="visiblecmdlets-and-visiblefunctions"></a><span data-ttu-id="8c9cd-226">VisibleCmdlets et VisibleFunctions</span><span class="sxs-lookup"><span data-stu-id="8c9cd-226">VisibleCmdlets and VisibleFunctions</span></span>

<span data-ttu-id="8c9cd-227">La logique de fusion la plus complexe affecte les applets de commande et les fonctions, dont les paramètres et les valeurs de paramètres peuvent être limités dans JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-227">The most complex merge logic affects cmdlets and functions, which can have their parameters and parameter values limited in JEA.</span></span>

<span data-ttu-id="8c9cd-228">Les règles sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="8c9cd-228">The rules are as follows:</span></span>

1. <span data-ttu-id="8c9cd-229">Si une applet de commande n’est visible que dans un seul rôle, elle est visible par l’utilisateur avec les contraintes de paramètres applicables.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-229">If a cmdlet is only made visible in one role, it is visible to the user with any applicable parameter constraints.</span></span>
2. <span data-ttu-id="8c9cd-230">Si une applet de commande est visible dans plusieurs rôles, et que chaque rôle a les mêmes contraintes sur l’applet de commande, l’applet de commande est visible par l’utilisateur avec ces contraintes.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-230">If a cmdlet is made visible in more than one role, and each role has the same constraints on the cmdlet, the cmdlet is visible to the user with those constraints.</span></span>
3. <span data-ttu-id="8c9cd-231">Si une applet de commande est visible dans plusieurs rôles, et que les rôles autorisent différents ensembles de paramètres, l’applet de commande et tous les paramètres définis sur tous les rôles sont visibles par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-231">If a cmdlet is made visible in more than one role, and each role allows a different set of parameters, the cmdlet and all the parameters defined across every role are visible to the user.</span></span>
   <span data-ttu-id="8c9cd-232">Si un rôle n’a pas de contraintes sur les paramètres, tous les paramètres sont autorisés.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-232">If one role doesn't have constraints on the parameters, all parameters are allowed.</span></span>
4. <span data-ttu-id="8c9cd-233">Si un rôle définit un ensemble ou un modèle de validation d’un paramètre d’applet de commande, et qu’un autre rôle autorise le paramètre mais ne contraint pas les valeurs du paramètre, l’ensemble ou le modèle de validation est ignoré.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-233">If one role defines a validate set or validate pattern for a cmdlet parameter, and the other role allows the parameter but does not constrain the parameter values, the validate set or pattern is ignored.</span></span>
5. <span data-ttu-id="8c9cd-234">Si un ensemble de validation est défini pour le même paramètre d’applet de commande dans plusieurs rôles, toutes les valeurs de tous les ensembles de validation sont autorisées.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-234">If a validate set is defined for the same cmdlet parameter in more than one role, all values from all validate sets are allowed.</span></span>
6. <span data-ttu-id="8c9cd-235">Si un modèle de validation est défini pour le même paramètre d’applet de commande dans plusieurs rôles, toutes les valeurs qui correspondent aux modèles sont autorisées.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-235">If a validate pattern is defined for the same cmdlet parameter in more than one role, any values that match any of the patterns are allowed.</span></span>
7. <span data-ttu-id="8c9cd-236">Si un ensemble de validation est défini dans un ou plusieurs rôles, et qu’un modèle de validation est défini dans un autre rôle pour le même paramètre d’applet de commande, l’ensemble de validation est ignoré et la règle (6) s’applique aux modèles de validation restants.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-236">If a validate set is defined in one or more roles, and a validate pattern is defined in another role for the same cmdlet parameter, the validate set is ignored and rule (6) applies to the remaining validate patterns.</span></span>

<span data-ttu-id="8c9cd-237">Vous trouverez ci-dessous un exemple de la façon dont les rôles sont fusionnés en fonction de ces règles :</span><span class="sxs-lookup"><span data-stu-id="8c9cd-237">Below is an example of how roles are merged according to these rules:</span></span>

```powershell
# Role A Visible Cmdlets
$roleA = @{
    VisibleCmdlets = 'Get-Service',
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Client' } }
}

# Role B Visible Cmdlets
$roleB = @{
    VisibleCmdlets = @{ Name = 'Get-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidatePattern = 'DNS.*' } },
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Server' } }
}

# Resulting permissions for a user who belongs to both role A and B
# - The constraint in role B for the DisplayName parameter on Get-Service
#   is ignored because of rule #4
# - The ValidateSets for Restart-Service are merged because both roles use
#   ValidateSet on the same parameter per rule #5
$mergedAandB = @{
    VisibleCmdlets = 'Get-Service',
                     @{ Name = 'Restart-Service';
                        Parameters = @{ Name = 'DisplayName'; ValidateSet = 'DNS Client', 'DNS Server' } }
}
```

### <a name="visibleexternalcommands-visiblealiases-visibleproviders-scriptstoprocess"></a><span data-ttu-id="8c9cd-238">VisibleExternalCommands, VisibleAliases, VisibleProviders, ScriptsToProcess</span><span class="sxs-lookup"><span data-stu-id="8c9cd-238">VisibleExternalCommands, VisibleAliases, VisibleProviders, ScriptsToProcess</span></span>

<span data-ttu-id="8c9cd-239">Tous les autres champs du fichier de capacités de rôle sont ajoutés à un ensemble cumulatif de commandes externes admissibles, d’alias, de fournisseurs et de scripts de démarrage.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-239">All other fields in the role capability file are added to a cumulative set of allowable external commands, aliases, providers, and startup scripts.</span></span> <span data-ttu-id="8c9cd-240">Les commandes, alias, fournisseurs ou scripts disponibles dans une capacité de rôle sont disponibles pour l’utilisateur JEA.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-240">Any command, alias, provider, or script available in one role capability is available to the JEA user.</span></span>

<span data-ttu-id="8c9cd-241">Veillez à ce que l’ensemble combiné de fournisseurs d’une capacité de rôle et les applets de commande/fonctions/commandes d’une autre n’autorisent pas les utilisateurs à accéder involontairement à des ressources système.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-241">Be careful to ensure that the combined set of providers from one role capability and cmdlets/functions/commands from another don't allow users unintentional access to system resources.</span></span>
<span data-ttu-id="8c9cd-242">Par exemple, si un rôle autorise l’applet de commande `Remove-Item` et un autre le fournisseur `FileSystem`, il existe un risque qu’un utilisateur JEA supprime des fichiers arbitraires sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="8c9cd-242">For example, if one role allows the `Remove-Item` cmdlet and another allows the `FileSystem` provider, you are at risk of a JEA user deleting arbitrary files on your computer.</span></span> <span data-ttu-id="8c9cd-243">Vous trouverez des informations supplémentaires sur l’identification des autorisations effectives des utilisateurs dans l’article [Audit de JEA](audit-and-report.md).</span><span class="sxs-lookup"><span data-stu-id="8c9cd-243">Additional information about identifying users' effective permissions can be found in the [auditing JEA](audit-and-report.md) article.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8c9cd-244">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="8c9cd-244">Next steps</span></span>

[<span data-ttu-id="8c9cd-245">Créer un fichier de configuration de session</span><span class="sxs-lookup"><span data-stu-id="8c9cd-245">Create a session configuration file</span></span>](session-configurations.md)
