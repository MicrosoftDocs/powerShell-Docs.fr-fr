---
title: Choix du bon package NuGet PowerShell pour votre projet .NET
description: En plus des packages exécutables publiés avec chaque version de PowerShell, l’équipe PowerShell gère plusieurs packages disponibles sur NuGet. Ces packages permettent de cibler PowerShell en tant que plateforme d’API dans .NET.
ms.date: 06/25/2020
ms.custom: rjmholt
ms.openlocfilehash: 39369ed872faa76ad2c41d813da5e0a98cf1c078
ms.sourcegitcommit: d0461273abb6db099c5e784ef00f57fd551be4a6
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/01/2020
ms.locfileid: "85795286"
---
# <a name="choosing-the-right-powershell-nuget-package-for-your-net-project"></a><span data-ttu-id="b0478-104">Choix du bon package NuGet PowerShell pour votre projet .NET</span><span class="sxs-lookup"><span data-stu-id="b0478-104">Choosing the right PowerShell NuGet package for your .NET project</span></span>

<span data-ttu-id="b0478-105">En plus des packages exécutables `pwsh` publiés avec chaque version de PowerShell, l’équipe PowerShell gère plusieurs packages disponibles sur [NuGet][].</span><span class="sxs-lookup"><span data-stu-id="b0478-105">Alongside the `pwsh` executable packages published with each PowerShell release, the PowerShell team also maintains several packages available on [NuGet][].</span></span> <span data-ttu-id="b0478-106">Ces packages permettent de cibler PowerShell en tant que plateforme d’API dans .NET.</span><span class="sxs-lookup"><span data-stu-id="b0478-106">These packages allow targeting PowerShell as an API platform in .NET.</span></span>

<span data-ttu-id="b0478-107">En tant qu’application .NET qui fournit des API et qui est censée charger des bibliothèques .NET qui implémentent ses propres modules binaires, il est essentiel que PowerShell soit disponible sous la forme d’un package NuGet.</span><span class="sxs-lookup"><span data-stu-id="b0478-107">As a .NET application that provides APIs and expects to load .NET libraries implementing its own (binary modules), it's essential that PowerShell be available in the form of a NuGet package.</span></span>

<span data-ttu-id="b0478-108">Il existe plusieurs packages NuGet qui fournissent une représentation de la surface d’exposition des API PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-108">Currently there are several NuGet packages that provide some representation of the PowerShell API surface area.</span></span> <span data-ttu-id="b0478-109">Il n’est pas toujours évident de savoir quel package utiliser avec un projet particulier.</span><span class="sxs-lookup"><span data-stu-id="b0478-109">Which package to use with a particular project hasn't always been made clear.</span></span> <span data-ttu-id="b0478-110">Cet article aborde quelques scénarios courants pour les projets .NET ciblant PowerShell et la manière de choisir le package NuGet à cibler pour votre projet .NET orienté PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-110">This article sheds some light on a few common scenarios for PowerShell-targeting .NET projects and how to choose the right NuGet package to target for your PowerShell-oriented .NET project.</span></span>

## <a name="hosting-vs-referencing"></a><span data-ttu-id="b0478-111">Hébergement ou référencement</span><span class="sxs-lookup"><span data-stu-id="b0478-111">Hosting vs referencing</span></span>

<span data-ttu-id="b0478-112">Certains projets .NET cherchent à écrire du code à charger dans un runtime PowerShell préexistant (comme `pwsh`, `powershell.exe`, la console intégrée PowerShell ou ISE), tandis que d’autres souhaitent exécuter PowerShell dans leurs propres applications.</span><span class="sxs-lookup"><span data-stu-id="b0478-112">Some .NET projects seek to write code to be loaded into a pre-existing PowerShell runtime (such as `pwsh`, `powershell.exe`, the PowerShell Integrated Console or the ISE), while others want to run PowerShell in their own applications.</span></span>

- <span data-ttu-id="b0478-113">Le **référencement** correspond à la situation dans laquelle un projet, généralement un module, est destiné à être chargé dans PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-113">**Referencing** is for when a project, usually a module, is intended to be loaded into PowerShell.</span></span>
  <span data-ttu-id="b0478-114">Il doit être compilé par rapport aux API que fournit PowerShell pour interagir avec lui, mais l’implémentation de PowerShell est fournie par le processus PowerShell qui le charge.</span><span class="sxs-lookup"><span data-stu-id="b0478-114">It must be compiled against the APIs that PowerShell provides in order to interact with it, but the PowerShell implementation is supplied by the PowerShell process loading it in.</span></span> <span data-ttu-id="b0478-115">Pour le référencement, un projet peut utiliser des [assemblys de référence][] ou les assemblys de runtime réels en tant que cible de compilation, mais il doit s’assurer de ne publier aucun d’entre eux avec sa build.</span><span class="sxs-lookup"><span data-stu-id="b0478-115">For referencing, a project can use [reference assemblies][] or the actual runtime assemblies as a compilation target, but must ensure that it does not publish any of these with its build.</span></span>
- <span data-ttu-id="b0478-116">L’**hébergement** correspond à la situation dans laquelle un projet a besoin de sa propre implémentation de PowerShell, généralement parce qu’il s’agit d’une application autonome qui doit exécuter PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-116">**Hosting** is when a project needs its own implementation of PowerShell, usually because it is a standalone application that needs to run PowerShell.</span></span> <span data-ttu-id="b0478-117">Dans ce cas, les assemblys de référence purs ne peuvent pas être utilisés.</span><span class="sxs-lookup"><span data-stu-id="b0478-117">In this case, pure reference assemblies cannot be used.</span></span> <span data-ttu-id="b0478-118">Vous devez plutôt faire appel à une implémentation concrète de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-118">Instead, a concrete PowerShell implementation must be depended upon.</span></span> <span data-ttu-id="b0478-119">Une implémentation concrète de PowerShell devant être utilisée, une version spécifique de PowerShell doit être choisie pour l’hébergement ; une application hôte unique ne peut pas cibler plusieurs versions de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-119">Because a concrete PowerShell implementation must be used, a specific version of PowerShell must be chosen for hosting; a single host application cannot multi-target PowerShell versions.</span></span>

### <a name="publishing-projects-that-target-powershell-as-a-reference"></a><span data-ttu-id="b0478-120">Publication de projets ciblant PowerShell en tant que référence</span><span class="sxs-lookup"><span data-stu-id="b0478-120">Publishing projects that target PowerShell as a reference</span></span>

> [!NOTE]
> <span data-ttu-id="b0478-121">Nous utilisons le terme **publier** dans cet article pour faire référence à l’exécution de `dotnet publish`, qui place une bibliothèque .NET dans un répertoire avec toutes ses dépendances en vue de son déploiement sur un runtime particulier.</span><span class="sxs-lookup"><span data-stu-id="b0478-121">We use the term **publish** in this article to refer to running `dotnet publish`, which places a .NET library into a directory with all of its dependencies, ready for deployment to a particular runtime.</span></span>

<span data-ttu-id="b0478-122">Pour empêcher la publication de dépendances de projet qui sont utilisées uniquement comme cibles de référence de compilation, nous vous recommandons de définir l’[attribut PrivateAssets][] :</span><span class="sxs-lookup"><span data-stu-id="b0478-122">In order to prevent publishing project dependencies that are just being used as compilation reference targets, it is recommended to set the [PrivateAssets attribute][]:</span></span>

```xml
<PackageReference Include="PowerShellStandard.Library" Version="5.1.0.0" PrivateAssets="all" />
```

<span data-ttu-id="b0478-123">Si vous oubliez de le faire et que vous utilisez un assembly de référence comme cible, vous risquez de voir des problèmes liés à l’utilisation de l’implémentation par défaut de l’assembly de référence au lieu de l’implémentation réelle.</span><span class="sxs-lookup"><span data-stu-id="b0478-123">If you forget to do this and use a reference assembly as your target, you may see issues related to using the reference assembly's default implementation instead of the actual implementation.</span></span> <span data-ttu-id="b0478-124">Cela peut prendre la forme d’une `NullReferenceException`, car les assemblys de référence simulent souvent l’API d’implémentation en retournant simplement `null`.</span><span class="sxs-lookup"><span data-stu-id="b0478-124">This may take the form of a `NullReferenceException`, since reference assemblies often mock the implementation API by simply returning `null`.</span></span>

## <a name="key-kinds-of-powershell-targeting-net-projects"></a><span data-ttu-id="b0478-125">Principaux types de projets .NET ciblant PowerShell</span><span class="sxs-lookup"><span data-stu-id="b0478-125">Key kinds of PowerShell-targeting .NET projects</span></span>

<span data-ttu-id="b0478-126">Même si une bibliothèque ou une application .NET peut incorporer PowerShell, il existe des scénarios courants qui utilisent les API PowerShell :</span><span class="sxs-lookup"><span data-stu-id="b0478-126">While any .NET library or application can embed PowerShell, there are some common scenarios that use PowerShell APIs:</span></span>

- <span data-ttu-id="b0478-127">**Implémentation d’un module binaire PowerShell**</span><span class="sxs-lookup"><span data-stu-id="b0478-127">**Implementing a PowerShell binary module**</span></span>

  <span data-ttu-id="b0478-128">Les modules binaires PowerShell sont des bibliothèques .NET chargées par PowerShell qui doivent implémenter des API PowerShell telles que les types [PSCmdlet][] ou [CmdletProvider][] afin d’exposer les applets de commande ou les fournisseurs, respectivement.</span><span class="sxs-lookup"><span data-stu-id="b0478-128">PowerShell binary modules are .NET libraries loaded by PowerShell that must implement PowerShell APIs like the [PSCmdlet][] or [CmdletProvider][] types in order to expose cmdlets or providers respectively.</span></span> <span data-ttu-id="b0478-129">Étant donné qu’ils sont chargés, les modules cherchent à se compiler par rapport à des références à PowerShell sans le publier dans leur build.</span><span class="sxs-lookup"><span data-stu-id="b0478-129">Because they are loaded in, modules seek to compile against references to PowerShell without publishing it in their build.</span></span> <span data-ttu-id="b0478-130">Il est également courant que les modules prennent en charge plusieurs versions et plateformes de PowerShell, idéalement avec un minimum de surcharge d’espace disque, de complexité ou d’implémentation répétée.</span><span class="sxs-lookup"><span data-stu-id="b0478-130">It's also common for modules to want to support multiple PowerShell versions and platforms, ideally with a minimum of overhead of disk space, complexity, or repeated implementation.</span></span> <span data-ttu-id="b0478-131">Pour plus d’informations sur les modules, consultez [À propos des modules][].</span><span class="sxs-lookup"><span data-stu-id="b0478-131">See [about_Modules][] for more information about modules.</span></span>

- <span data-ttu-id="b0478-132">**Implémentation d’un hôte PowerShell**</span><span class="sxs-lookup"><span data-stu-id="b0478-132">**Implementing a PowerShell Host**</span></span>

  <span data-ttu-id="b0478-133">Un hôte PowerShell fournit une couche d’interaction pour le runtime PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-133">A PowerShell Host provides an interaction layer for the PowerShell runtime.</span></span> <span data-ttu-id="b0478-134">Il s’agit d’une forme spécifique d’_hébergement_, où un [PSHost][] est implémenté en tant que nouvelle interface utilisateur pour PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-134">It is a specific form of _hosting_, where a [PSHost][] is implemented as a new user interface to PowerShell.</span></span> <span data-ttu-id="b0478-135">Par exemple, le ConsoleHost PowerShell fournit une interface utilisateur de terminal pour les exécutables PowerShell, tandis que l’hôte des services de l’éditeur PowerShell et l’hôte ISE fournissent tous deux une interface graphique utilisateur partiellement intégrée à l’éditeur autour de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-135">For example, the PowerShell ConsoleHost provides a terminal user interface for PowerShell executables, while the PowerShell Editor Services Host and the ISE Host both provide an editor-integrated partially graphical user interface around PowerShell.</span></span> <span data-ttu-id="b0478-136">Même s’il est possible de charger un hôte sur un processus PowerShell existant, il est bien plus courant pour une implémentation d’hôte d’agir en tant qu’implémentation PowerShell autonome qui redistribue le moteur PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-136">While it's possible to load a host onto an existing PowerShell process, it's much more common for a host implementation to act as a standalone PowerShell implementation that redistributes the PowerShell engine.</span></span>

- <span data-ttu-id="b0478-137">**Appel de PowerShell à partir d’une autre application .NET**</span><span class="sxs-lookup"><span data-stu-id="b0478-137">**Calling into PowerShell from another .NET application**</span></span>

  <span data-ttu-id="b0478-138">Comme pour n’importe quelle application, PowerShell peut être appelé en tant que sous-processus pour exécuter des charges de travail.</span><span class="sxs-lookup"><span data-stu-id="b0478-138">As with any application, PowerShell can be called as a subprocess to run workloads.</span></span> <span data-ttu-id="b0478-139">Toutefois, en tant qu’application .NET, il est également possible d’appeler PowerShell in-process pour obtenir les objets .NET complets à utiliser dans l’application appelante.</span><span class="sxs-lookup"><span data-stu-id="b0478-139">However, as a .NET application, it's also possible to invoke PowerShell in-process to get back full .NET objects for use within the calling application.</span></span> <span data-ttu-id="b0478-140">Il s’agit d’une forme plus générale d’_hébergement_, où l’application contient sa propre implémentation de PowerShell pour une utilisation interne.</span><span class="sxs-lookup"><span data-stu-id="b0478-140">This is a more general form of _hosting_, where the application holds its own PowerShell implementation for internal use.</span></span> <span data-ttu-id="b0478-141">À titre d’exemple, citons un service ou un démon exécutant PowerShell pour gérer l’état d’une machine ou une application web qui exécute PowerShell à la demande pour effectuer des tâches telles que la gestion des déploiements cloud.</span><span class="sxs-lookup"><span data-stu-id="b0478-141">Examples of this might be a service or daemon running PowerShell to manage machine state or a web application that runs PowerShell on request to do something like manage cloud deployments.</span></span>

- <span data-ttu-id="b0478-142">**Tests unitaires de modules PowerShell à partir de .NET**</span><span class="sxs-lookup"><span data-stu-id="b0478-142">**Unit testing PowerShell modules from .NET**</span></span>

  <span data-ttu-id="b0478-143">Même si les modules et les autres bibliothèques conçus pour exposer des fonctionnalités à PowerShell doivent être testés à partir de PowerShell (nous vous recommandons [Pester][]), il est parfois nécessaire de soumettre à des tests unitaires les API écrites pour un module PowerShell à partir de .NET.</span><span class="sxs-lookup"><span data-stu-id="b0478-143">While modules and other libraries designed to expose functionality to PowerShell should be primarily tested from PowerShell (we recommend [Pester][]), sometimes it's necessary to unit test APIs written for a PowerShell module from .NET.</span></span> <span data-ttu-id="b0478-144">Dans ce cas, le code de module tente de cibler un certain nombre de versions de PowerShell, tandis que les tests doivent l’exécuter sur des implémentations concrètes spécifiques.</span><span class="sxs-lookup"><span data-stu-id="b0478-144">This situation involves the module code trying to target a number of PowerShell versions, while testing should run it on specific, concrete implementations.</span></span>

## <a name="powershell-nuget-packages-at-a-glance"></a><span data-ttu-id="b0478-145">Packages NuGet PowerShell en un clin d’œil</span><span class="sxs-lookup"><span data-stu-id="b0478-145">PowerShell NuGet packages at a glance</span></span>

<span data-ttu-id="b0478-146">Dans cet article, nous allons aborder les packages NuGet suivants qui exposent les API PowerShell :</span><span class="sxs-lookup"><span data-stu-id="b0478-146">In this article, we'll cover the following NuGet packages that expose PowerShell APIs:</span></span>

- <span data-ttu-id="b0478-147">[PowerShellStandard.Library][] : assembly de référence qui permet de générer un assembly unique pouvant être chargé par plusieurs runtimes PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-147">[PowerShellStandard.Library][], a reference assembly that enables building a single assembly that can be loaded by multiple PowerShell runtimes.</span></span>
- <span data-ttu-id="b0478-148">[Microsoft.PowerShell.SDK][] : permet de cibler et de réhéberger l’ensemble du SDK PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-148">[Microsoft.PowerShell.SDK][], the way to target and rehost the whole PowerShell SDK</span></span>
- <span data-ttu-id="b0478-149">[System.Management.Automation][] : implémentation principale du moteur et du runtime PowerShell, qui peut être utile dans les implémentations hébergées minimales et pour les scénarios de ciblage spécifiques à la version.</span><span class="sxs-lookup"><span data-stu-id="b0478-149">The [System.Management.Automation][] package, the core PowerShell runtime and engine implementation, that can be useful in minimal hosted implementations and for version-specific targeting scenarios.</span></span>
- <span data-ttu-id="b0478-150">**Assemblys de référence Windows PowerShell** : permettent de cibler et de réhéberger efficacement Windows PowerShell (versions 5.1 et antérieures de PowerShell).</span><span class="sxs-lookup"><span data-stu-id="b0478-150">The **Windows PowerShell reference assemblies**, the way to target and effectively rehost Windows PowerShell (PowerShell versions 5.1 and below).</span></span>

> [!NOTE]
> <span data-ttu-id="b0478-151">Le package [NuGet PowerShell][] n’est pas du tout un package de bibliothèques .NET ; il fournit l’implémentation de l’outil global .NET de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-151">The [PowerShell NuGet][] package is not a .NET library package at all, but instead provides the PowerShell dotnet global tool implementation.</span></span> <span data-ttu-id="b0478-152">Il ne doit pas être utilisé par des projets, car il fournit uniquement un exécutable.</span><span class="sxs-lookup"><span data-stu-id="b0478-152">This should not be used by any projects, since it only provides an executable.</span></span>

## <a name="powershellstandardlibrary"></a><span data-ttu-id="b0478-153">PowerShellStandard.Library</span><span class="sxs-lookup"><span data-stu-id="b0478-153">PowerShellStandard.Library</span></span>

<span data-ttu-id="b0478-154">La bibliothèque Standard PowerShell est un assembly de référence qui capture l’intersection des API des versions de PowerShell 7, 6 et 5.1.</span><span class="sxs-lookup"><span data-stu-id="b0478-154">The PowerShell Standard library is a reference assembly that captures the intersection of the APIs of PowerShell versions 7, 6 and 5.1.</span></span> <span data-ttu-id="b0478-155">Elle fournit une surface d’API vérifiée au moment de la compilation vis-à-vis de laquelle effectuer la compilation du code .NET, ce qui permet aux projets .NET de cibler les versions PowerShell 7, 6 et 5.1 sans risquer d’appeler une API absente.</span><span class="sxs-lookup"><span data-stu-id="b0478-155">This provides a compile-time-checked API surface to compile .NET code against, allowing .NET projects to target PowerShell versions 7, 6 and 5.1 without risking calling an API that won't be there.</span></span>

<span data-ttu-id="b0478-156">PowerShell Standard est destinée à l’écriture de modules PowerShell ou d’autre code à exécuter uniquement après son chargement dans un processus PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-156">PowerShell Standard is intended for writing PowerShell modules, or other code only intended to be run after loading it into a PowerShell process.</span></span> <span data-ttu-id="b0478-157">Étant donné qu’il s’agit d’un assembly de référence, PowerShell Standard ne contient aucune implémentation proprement dite. Elle ne fournit donc aucune fonctionnalité pour les applications autonomes.</span><span class="sxs-lookup"><span data-stu-id="b0478-157">Because it is a reference assembly, PowerShell Standard contains no implementation itself, so provides no functionality for standalone applications.</span></span>

### <a name="using-powershell-standard-with-different-net-runtimes"></a><span data-ttu-id="b0478-158">Utilisation de PowerShell Standard avec différents runtimes .NET</span><span class="sxs-lookup"><span data-stu-id="b0478-158">Using PowerShell Standard with different .NET runtimes</span></span>

<span data-ttu-id="b0478-159">PowerShell Standard cible le runtime [.NET Standard 2.0][], runtime de façade conçu pour fournir une surface d’exposition commune partagée par .NET Framework et .NET Core.</span><span class="sxs-lookup"><span data-stu-id="b0478-159">PowerShell Standard targets the [.NET Standard 2.0][] target runtime, which is a façade runtime designed to provide a common surface area shared by .NET Framework and .NET Core.</span></span> <span data-ttu-id="b0478-160">Cela permet de cibler un seul runtime en vue de produire un assembly unique qui fonctionne avec plusieurs versions de PowerShell, mais les conséquences sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="b0478-160">This allows targeting a single runtime to produce a single assembly that will work with multiple PowerShell versions, but has the following consequences:</span></span>

- <span data-ttu-id="b0478-161">Le code PowerShell qui charge le module ou la bibliothèque doit exécuter au minimum .NET 4.6.1 ; .NET 4.6 et .NET 4.5.2 ne prennent pas en charge .NET Standard.</span><span class="sxs-lookup"><span data-stu-id="b0478-161">The PowerShell loading the module or library must be running a minimum of .NET 4.6.1; .NET 4.6 and .NET 4.5.2 do not support .NET Standard.</span></span> <span data-ttu-id="b0478-162">Notez qu’une version plus récente de Windows PowerShell ne signifie pas une version plus récente de .NET Framework ; Windows PowerShell 5.1 peut s’exécuter sur .NET 4.5.2.</span><span class="sxs-lookup"><span data-stu-id="b0478-162">Note that a newer Windows PowerShell version does not mean a newer .NET Framework version; Windows PowerShell 5.1 may run on .NET 4.5.2.</span></span>
- <span data-ttu-id="b0478-163">Pour utiliser un code PowerShell exécutant .NET Framework 4.7.1 ou une version antérieure, l’implémentation de [NETStandard.Library][] pour .NET 4.6.1 est nécessaire afin de fournir le fichier netstandard.dll et d’autres assemblys shim dans les anciennes versions de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b0478-163">In order to work with a PowerShell running .NET Framework 4.7.1 or below, the .NET 4.6.1 [NETStandard.Library][] implementation is required to provide the netstandard.dll and other shim assemblies in older .NET Framework versions.</span></span>

<span data-ttu-id="b0478-164">Les versions 6 et ultérieures de PowerShell fournissent leurs propres assemblys shim pour le transfert de type à partir de .NET Framework 4.6.1 (et versions ultérieures) vers .NET Core.</span><span class="sxs-lookup"><span data-stu-id="b0478-164">PowerShell 6+ provides its own shim assemblies for type forwarding from .NET Framework 4.6.1 (and above) to .NET Core.</span></span> <span data-ttu-id="b0478-165">Cela signifie que tant qu’un module utilise uniquement des API qui existent dans .NET Core, les versions 6 et ultérieures de PowerShell peuvent le charger et l’exécuter quand il a été généré pour .NET Framework 4.6.1 (la cible de runtime `net461`).</span><span class="sxs-lookup"><span data-stu-id="b0478-165">This means that as long as a module uses only APIs that exist in .NET Core, PowerShell 6+ can load and run it when it has been built for .NET Framework 4.6.1 (the `net461` runtime target).</span></span>

<span data-ttu-id="b0478-166">Ainsi, les modules binaires utilisant PowerShell Standard pour cibler plusieurs versions de PowerShell avec une seule DLL publiée ont deux options :</span><span class="sxs-lookup"><span data-stu-id="b0478-166">This means that binary modules using PowerShell Standard to target multiple PowerShell versions with a single published DLL have two options:</span></span>

1. <span data-ttu-id="b0478-167">Publication d’un assembly généré pour le runtime cible `net461`.</span><span class="sxs-lookup"><span data-stu-id="b0478-167">Publishing an assembly built for the `net461` target runtime.</span></span> <span data-ttu-id="b0478-168">Cela implique les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="b0478-168">This involves:</span></span>
   - <span data-ttu-id="b0478-169">Publication du projet pour le runtime `net461`</span><span class="sxs-lookup"><span data-stu-id="b0478-169">Publishing the project for the `net461` runtime</span></span>
   - <span data-ttu-id="b0478-170">Compilation par rapport au runtime `netstandard2.0` (sans utiliser sa sortie de génération) pour que toutes les API utilisées soient également présentes dans .NET Core.</span><span class="sxs-lookup"><span data-stu-id="b0478-170">Also compiling against the `netstandard2.0` runtime (without using its build output) to ensure that all APIs used are also present in .NET Core.</span></span>

1. <span data-ttu-id="b0478-171">Publication d’un assembly généré pour le runtime cible `netstandard2.0`.</span><span class="sxs-lookup"><span data-stu-id="b0478-171">Publishing an assembly build for the `netstandard2.0` target runtime.</span></span> <span data-ttu-id="b0478-172">Cela implique les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="b0478-172">This requires:</span></span>
   - <span data-ttu-id="b0478-173">Publication du projet pour le runtime `netstandard2.0`</span><span class="sxs-lookup"><span data-stu-id="b0478-173">Publishing the project for the `netstandard2.0` runtime</span></span>
   - <span data-ttu-id="b0478-174">Prise des dépendances `net461` de NETStandard.Library et copie de ces dernières au point de publication de l’assembly de projet afin que l’assembly soit corrigé avec le transfert de type dans .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b0478-174">Taking the `net461` dependencies of NETStandard.Library and copying them into the project assembly's publish location so that the assembly is type-forwarded corrected in .NET Framework.</span></span>

<span data-ttu-id="b0478-175">Pour générer des modules ou des bibliothèques PowerShell ciblant des versions antérieures de .NET Framework, il peut être préférable de cibler plusieurs runtimes .NET.</span><span class="sxs-lookup"><span data-stu-id="b0478-175">To build PowerShell modules or libraries targeting older .NET Framework versions, it may be preferable to target multiple .NET runtimes.</span></span> <span data-ttu-id="b0478-176">Cette opération publie un assembly pour chaque runtime cible, et l’assembly approprié doit être chargé au moment du chargement du module (par exemple, avec un petit module psm1 comme module racine).</span><span class="sxs-lookup"><span data-stu-id="b0478-176">This will publish an assembly for each target runtime, and the correct assembly will need to be loaded at module load time (for example with a small psm1 as the root module).</span></span>

### <a name="testing-powershell-standard-projects-in-net"></a><span data-ttu-id="b0478-177">Test de projets PowerShell Standard dans .NET</span><span class="sxs-lookup"><span data-stu-id="b0478-177">Testing PowerShell Standard projects in .NET</span></span>

<span data-ttu-id="b0478-178">Quand vient l’heure de tester votre module dans des exécuteurs de test .NET comme xUnit, n’oubliez pas que les vérifications au moment de la compilation ne peuvent pas aller plus loin.</span><span class="sxs-lookup"><span data-stu-id="b0478-178">When it comes to testing your module in .NET test runners like xUnit, remember that compile-time checks can only go so far.</span></span> <span data-ttu-id="b0478-179">Vous devez tester votre module sur les plateformes PowerShell appropriées.</span><span class="sxs-lookup"><span data-stu-id="b0478-179">You must test your module against the relevant PowerShell platforms.</span></span>

<span data-ttu-id="b0478-180">Pour tester les API générées par rapport à PowerShell Standard dans .NET, vous devez ajouter `Microsoft.Powershell.SDK` en tant que dépendance de test avec .NET Core (dont la version doit être définie de façon à correspondre à la version de PowerShell souhaitée) et les assemblys de référence Windows PowerShell appropriés avec .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="b0478-180">To test APIs built against PowerShell Standard in .NET, you should add `Microsoft.Powershell.SDK` as a testing dependency with .NET Core (with the version set to match the desired PowerShell version), and the appropriate Windows PowerShell reference assemblies with .NET Framework.</span></span>

<span data-ttu-id="b0478-181">Pour plus d’informations sur PowerShell Standard et son utilisation pour écrire un module binaire qui fonctionne dans plusieurs versions de PowerShell, consultez [ce billet de blog][].</span><span class="sxs-lookup"><span data-stu-id="b0478-181">For more information on PowerShell Standard and using it to write a binary module that works in multiple PowerShell versions, see [this blog post][].</span></span> <span data-ttu-id="b0478-182">Consultez également le [dépôt PowerShell Standard][] sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="b0478-182">Also see the [PowerShell Standard repository][] on GitHub.</span></span>

## <a name="microsoftpowershellsdk"></a><span data-ttu-id="b0478-183">Microsoft.PowerShell.SDK</span><span class="sxs-lookup"><span data-stu-id="b0478-183">Microsoft.PowerShell.SDK</span></span>

<span data-ttu-id="b0478-184">`Microsoft.PowerShell.SDK` est un méta-package qui rassemble tous les composants du SDK PowerShell en un package NuGet unique.</span><span class="sxs-lookup"><span data-stu-id="b0478-184">`Microsoft.PowerShell.SDK` is a meta-package that pulls together all of the components of the PowerShell SDK into a single NuGet package.</span></span> <span data-ttu-id="b0478-185">Une application .NET autonome peut utiliser Microsoft.PowerShell.SDK pour exécuter des fonctionnalités PowerShell arbitraires sans dépendre d’installations ou de bibliothèques PowerShell externes.</span><span class="sxs-lookup"><span data-stu-id="b0478-185">A self-contained .NET application can use Microsoft.PowerShell.SDK to run arbitrary PowerShell functionality without depending on any external PowerShell installations or libraries.</span></span>

> [!NOTE]
> <span data-ttu-id="b0478-186">Le SDK PowerShell fait simplement référence à tous les packages de composants qui constituent PowerShell et qui peuvent être utilisés pour le développement .NET avec PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-186">The PowerShell SDK just refers to all the component packages that make up PowerShell, and which can be used for .NET development with PowerShell.</span></span>

<span data-ttu-id="b0478-187">Une version de `Microsoft.Powershell.SDK` donnée contient l’implémentation concrète de la même version de l’application PowerShell ; la version 7.0 contient l’implémentation de PowerShell 7.0 et l’exécution de commandes ou de scripts avec elle s’apparente largement à leur exécution dans PowerShell 7.0.</span><span class="sxs-lookup"><span data-stu-id="b0478-187">A given `Microsoft.Powershell.SDK` version contains the concrete implementation of the same version of the PowerShell application; version 7.0 contains the implementation of PowerShell 7.0 and running commands or scripts with it will largely behave like running them in PowerShell 7.0.</span></span>

<span data-ttu-id="b0478-188">L’exécution de commandes PowerShell à partir du SDK est essentiellement, mais pas totalement, identique à leur exécution à partir de `pwsh`.</span><span class="sxs-lookup"><span data-stu-id="b0478-188">Running PowerShell commands from the SDK is mostly, but not totally, the same as running them from `pwsh`.</span></span> <span data-ttu-id="b0478-189">Par exemple, [Start-Job][], qui dépend de la disponibilité de l’exécutable `pwsh`, ne fonctionne pas avec `Microsoft.Powershell.SDK` par défaut.</span><span class="sxs-lookup"><span data-stu-id="b0478-189">For example, [Start-Job][] currently depends on the `pwsh` executable being available, and so will not work with `Microsoft.Powershell.SDK` by default.</span></span>

<span data-ttu-id="b0478-190">Le ciblage de `Microsoft.Powershell.SDK` à partir d’une application .NET vous permet d’effectuer une intégration à tous les assemblys d’implémentation de PowerShell, tels que `System.Management.Automation`, `Microsoft.PowerShell.Management` et d’autres assemblys de module.</span><span class="sxs-lookup"><span data-stu-id="b0478-190">Targeting `Microsoft.Powershell.SDK` from a .NET application allows you to integrate with all of PowerShell's implementation assemblies, such as `System.Management.Automation`, `Microsoft.PowerShell.Management`, and other module assemblies.</span></span>

<span data-ttu-id="b0478-191">La publication d’une application ciblant `Microsoft.Powershell.SDK` inclut tous ces assemblys et toutes les dépendances nécessaires à PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-191">Publishing an application targeting `Microsoft.Powershell.SDK` will include all these assemblies, and any dependencies PowerShell requires.</span></span> <span data-ttu-id="b0478-192">Elle inclut également d’autres ressources requises par PowerShell dans sa build, telles que les manifestes de module pour les modules `Microsoft.PowerShell.*` et le répertoire `ref` requis par [Add-Type][].</span><span class="sxs-lookup"><span data-stu-id="b0478-192">It will also include other assets that PowerShell required in its build, such as the module manifests for `Microsoft.PowerShell.*` modules and the `ref` directory required by [Add-Type][].</span></span>

<span data-ttu-id="b0478-193">`Microsoft.Powershell.SDK` étant exhaustif, il est idéal pour les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="b0478-193">Given the completeness of `Microsoft.Powershell.SDK`, it's best suited for:</span></span>

- <span data-ttu-id="b0478-194">Implémentation d’hôtes PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-194">Implementation of PowerShell hosts.</span></span>
- <span data-ttu-id="b0478-195">Exécution de tests xUnit sur les bibliothèques ciblant les assemblys de référence PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-195">xUnit testing of libraries targeting PowerShell reference assemblies.</span></span>
- <span data-ttu-id="b0478-196">Appel de PowerShell in-process à partir d’une application .NET.</span><span class="sxs-lookup"><span data-stu-id="b0478-196">Invoking PowerShell in-process from a .NET application.</span></span>

<span data-ttu-id="b0478-197">`Microsoft.PowerShell.SDK` peut également être utilisé comme cible de référence quand un projet .NET est destiné à être utilisé en tant que module ou bien chargé par PowerShell, mais dépend des API uniquement présentes dans une version particulière de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-197">`Microsoft.PowerShell.SDK` may also be used as a reference target when a .NET project is intended to be used as a module or otherwise loaded by PowerShell, but depends on APIs only present in a particular version of PowerShell.</span></span> <span data-ttu-id="b0478-198">Notez qu’un assembly publié par rapport à une version spécifique de `Microsoft.PowerShell.SDK` ne peut être chargé et utilisé de façon sécurisée que dans cette version de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-198">Note that an assembly published against a specific version of `Microsoft.PowerShell.SDK` will only be safe to load and use in that version of PowerShell.</span></span> <span data-ttu-id="b0478-199">Pour cibler plusieurs versions de PowerShell avec des API spécifiques, plusieurs builds sont nécessaires, chacune ciblant sa propre version de `Microsoft.Powershell.SDK`.</span><span class="sxs-lookup"><span data-stu-id="b0478-199">To target multiple PowerShell versions with specific APIs, multiple builds are required, each targeting their own version of `Microsoft.Powershell.SDK`.</span></span>

> [!NOTE]
> <span data-ttu-id="b0478-200">Le SDK PowerShell n’est disponible que pour les versions 6 et ultérieures de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-200">The PowerShell SDK is only available for PowerShell versions 6 and up.</span></span> <span data-ttu-id="b0478-201">Pour fournir des fonctionnalités équivalentes avec Windows PowerShell, utilisez les assemblys de référence Windows PowerShell décrits ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="b0478-201">To provide equivalent functionality with Windows PowerShell, use the Windows PowerShell reference assemblies described below.</span></span>

## <a name="systemmanagementautomation"></a><span data-ttu-id="b0478-202">System.Management.Automation</span><span class="sxs-lookup"><span data-stu-id="b0478-202">System.Management.Automation</span></span>

<span data-ttu-id="b0478-203">Le package `System.Management.Automation` est le cœur du SDK PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-203">The `System.Management.Automation` package is the heart of the PowerShell SDK.</span></span> <span data-ttu-id="b0478-204">Il existe sur NuGet, principalement, en tant que ressource que `Microsoft.Powershell.SDK` peut récupérer.</span><span class="sxs-lookup"><span data-stu-id="b0478-204">It exists on NuGet, primarily, as an asset for `Microsoft.Powershell.SDK` to pull in.</span></span> <span data-ttu-id="b0478-205">Toutefois, il peut également être utilisé directement comme package pour les scénarios d’hébergement de moindre envergure et les modules de ciblage de version.</span><span class="sxs-lookup"><span data-stu-id="b0478-205">However, it can also be used directly as a package for smaller hosting scenarios and version-targeting modules.</span></span>

<span data-ttu-id="b0478-206">Plus précisément, il peut être préférable d’utiliser le package `System.Management.Automation` pour fournir les fonctionnalités PowerShell dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="b0478-206">Specifically, the `System.Management.Automation` package may be a preferable provider of PowerShell functionality when:</span></span>

- <span data-ttu-id="b0478-207">Vous souhaitez uniquement utiliser les fonctionnalités de langage PowerShell (dans l’espace de noms `System.Management.Automation.Language`) comme l’analyseur PowerShell, l’arborescence AST et les API de visiteur de cette arborescence (par exemple, pour l’analyse statique de PowerShell).</span><span class="sxs-lookup"><span data-stu-id="b0478-207">You're only looking to use PowerShell language functionality (in the `System.Management.Automation.Language` namespace) like the PowerShell parser, AST, and AST visitor APIs (for example for static analysis of PowerShell).</span></span>
- <span data-ttu-id="b0478-208">Vous souhaitez uniquement exécuter des commandes spécifiques à partir du module `Microsoft.PowerShell.Core` et pouvez les exécuter dans un état de session créé à l’aide de la méthode de fabrique [CreateDefault2][].</span><span class="sxs-lookup"><span data-stu-id="b0478-208">You only wish to execute specific commands from the `Microsoft.PowerShell.Core` module and can execute them in a session state created with the [CreateDefault2][] factory method.</span></span>

<span data-ttu-id="b0478-209">En outre, `System.Management.Automation` est un assembly de référence utile dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="b0478-209">Additionally, `System.Management.Automation` is a useful reference assembly when:</span></span>

- <span data-ttu-id="b0478-210">Vous souhaitez cibler les API qui sont uniquement présentes dans une version PowerShell spécifique.</span><span class="sxs-lookup"><span data-stu-id="b0478-210">You wish to target APIs that are only present within a specific PowerShell version</span></span>
- <span data-ttu-id="b0478-211">Vous ne dépendez pas de types qui se trouvent en dehors de l’assembly `System.Management.Automation` (par exemple, les types exportés par des applets de commande dans les modules `Microsoft.PowerShell.*`).</span><span class="sxs-lookup"><span data-stu-id="b0478-211">You won't be depending on types occurring outside the `System.Management.Automation` assembly (for example, types exported by cmdlets in `Microsoft.PowerShell.*` modules).</span></span>

## <a name="windows-powershell-reference-assemblies"></a><span data-ttu-id="b0478-212">Assemblys de référence Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="b0478-212">Windows PowerShell reference assemblies</span></span>

<span data-ttu-id="b0478-213">Pour les versions de PowerShell 5.1 et antérieures (Windows PowerShell), il n’existe aucun SDK fournissant une implémentation de PowerShell, puisque l’implémentation de Windows PowerShell fait partie de Windows.</span><span class="sxs-lookup"><span data-stu-id="b0478-213">For PowerShell versions 5.1 and older (Windows PowerShell), there is no SDK to provide an implementation of PowerShell, since Windows PowerShell's implementation is a part of Windows.</span></span>

<span data-ttu-id="b0478-214">Au lieu de cela, les assemblys de référence Windows PowerShell fournissent des cibles de référence et un moyen de réhéberger Windows PowerShell, agissant de la même façon que le SDK PowerShell pour les versions 6 et ultérieures.</span><span class="sxs-lookup"><span data-stu-id="b0478-214">Instead, the Windows PowerShell reference assemblies provide both reference targets and a way to rehost Windows PowerShell, acting the same as the PowerShell SDK does for versions 6 and up.</span></span>

<span data-ttu-id="b0478-215">Plutôt que d’être différenciés par version, les assemblys de référence Windows PowerShell ont un package différent pour chaque version de Windows PowerShell :</span><span class="sxs-lookup"><span data-stu-id="b0478-215">Rather than being differentiated by version, Windows PowerShell reference assemblies have a different package for each version of Windows PowerShell:</span></span>

- [<span data-ttu-id="b0478-216">PowerShell 5.1</span><span class="sxs-lookup"><span data-stu-id="b0478-216">PowerShell 5.1</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.5.ReferenceAssemblies/)
- [<span data-ttu-id="b0478-217">PowerShell 4</span><span class="sxs-lookup"><span data-stu-id="b0478-217">PowerShell 4</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.4.ReferenceAssemblies/)
- [<span data-ttu-id="b0478-218">PowerShell 3</span><span class="sxs-lookup"><span data-stu-id="b0478-218">PowerShell 3</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.3.ReferenceAssemblies/)

<span data-ttu-id="b0478-219">Vous trouverez des informations sur l’utilisation des assemblys de référence Windows PowerShell dans le [SDK Windows PowerShell][].</span><span class="sxs-lookup"><span data-stu-id="b0478-219">Information on how to use the Windows PowerShell reference assemblies can be found in the [Windows PowerShell SDK][].</span></span>

## <a name="real-world-examples-using-these-nuget-packages"></a><span data-ttu-id="b0478-220">Exemples concrets utilisant ces packages NuGet</span><span class="sxs-lookup"><span data-stu-id="b0478-220">Real-world examples using these NuGet packages</span></span>

<span data-ttu-id="b0478-221">Différents projets d’outils PowerShell ciblent différents packages NuGet PowerShell en fonction de leurs besoins.</span><span class="sxs-lookup"><span data-stu-id="b0478-221">Different PowerShell tooling projects target different PowerShell NuGet packages depending on their needs.</span></span> <span data-ttu-id="b0478-222">Voici quelques exemples notables.</span><span class="sxs-lookup"><span data-stu-id="b0478-222">Listed here are some notable examples.</span></span>

### <a name="psreadline"></a><span data-ttu-id="b0478-223">PSReadLine</span><span class="sxs-lookup"><span data-stu-id="b0478-223">PSReadLine</span></span>

<span data-ttu-id="b0478-224">[PSReadLine][], module PowerShell qui fournit une grande partie de l’expérience de console enrichie de PowerShell, cible PowerShell Standard en tant que dépendance plutôt qu’une version de PowerShell spécifique et cible le runtime .NET `net461` dans son [csproj][].</span><span class="sxs-lookup"><span data-stu-id="b0478-224">[PSReadLine][], the PowerShell module that provides much of PowerShell's rich console experience, targets PowerShell Standard as a dependency rather than a specific PowerShell version, and targets the `net461` .NET runtime in its [csproj][].</span></span>

<span data-ttu-id="b0478-225">Les versions de PowerShell 6 et ultérieures fournissent leurs propres assemblys shim qui permettent à une DLL ciblant le runtime `net461` de « tout simplement fonctionner » quand elle est chargée (en redirigeant la liaison à la `mscorlib.dll` de .NET Framework vers l’assembly .NET Core approprié).</span><span class="sxs-lookup"><span data-stu-id="b0478-225">PowerShell 6+ supplies its own shim assemblies that allow a DLL targeting the `net461` runtime to "just work" when loaded in (by redirecting binding to .NET Framework's `mscorlib.dll` to the relevant .NET Core assembly).</span></span>

<span data-ttu-id="b0478-226">Cela simplifie considérablement la disposition et la remise des modules de PSReadLine, car PowerShell Standard garantit que seules les API utilisées sont présentes dans PowerShell 5.1, 6 et versions ultérieures, tout en autorisant également le module à être fourni avec un seul assembly.</span><span class="sxs-lookup"><span data-stu-id="b0478-226">This simplifies PSReadLine's module layout and delivery significantly, since PowerShell Standard ensures the only APIs used will be present in both PowerShell 5.1 and PowerShell 6+, while also allowing the module to ship with only a single assembly.</span></span>

<span data-ttu-id="b0478-227">Toutefois, la cible .NET 4.6.1 signifie que l’exécution de Windows PowerShell sur .NET 4.5.2 et .NET 4.6 n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="b0478-227">The .NET 4.6.1 target does mean that Windows PowerShell running on .NET 4.5.2 and .NET 4.6 is not supported though.</span></span>

### <a name="powershell-editor-services"></a><span data-ttu-id="b0478-228">PowerShell Editor Services</span><span class="sxs-lookup"><span data-stu-id="b0478-228">PowerShell Editor Services</span></span>

<span data-ttu-id="b0478-229">[PowerShell Editor Services][] (PSES) est le back-end de l’[extension PowerShell][] pour [Visual Studio Code][]. En fait, c’est une forme de module PowerShell qui se charge via un exécutable PowerShell et qui prend la main pour réhéberger PowerShell en son sein tout en fournissant des fonctionnalités de protocole de service de langage et d’adaptateur de débogage.</span><span class="sxs-lookup"><span data-stu-id="b0478-229">[PowerShell Editor Services][] (PSES) is the backend for the [PowerShell extension][] for [Visual Studio Code][], and is actually a form of PowerShell module that gets loaded by a PowerShell executable and then takes over that process to rehost PowerShell within itself while also providing Language Service Protocol and Debug Adapter features.</span></span>

<span data-ttu-id="b0478-230">PSES fournit des cibles d’implémentation concrète pour `netcoreapp2.1` afin de cibler les versions de PowerShell 6 et ultérieures (le runtime `netcoreapp3.1` de PowerShell 7 étant à compatibilité descendante) et `net461` afin de cibler Windows PowerShell 5.1, mais la majeure partie de sa logique se trouve dans un deuxième assembly qui cible `netstandard2.0` et PowerShell Standard.</span><span class="sxs-lookup"><span data-stu-id="b0478-230">PSES provides concrete implementation targets for `netcoreapp2.1` to target PowerShell 6+ (since PowerShell 7's `netcoreapp3.1` runtime is backwards compatible) and `net461` to target Windows PowerShell 5.1, but contains most of its logic in a second assembly that targets `netstandard2.0` and PowerShell Standard.</span></span> <span data-ttu-id="b0478-231">Cela lui permet de récupérer les dépendances requises pour les plateformes .NET Core et .NET Framework, tout en simplifiant la plupart du code base derrière une abstraction uniforme.</span><span class="sxs-lookup"><span data-stu-id="b0478-231">This allows it to pull in dependencies required for .NET Core and .NET Framework platforms, while still simplifying most of the codebase behind a uniform abstraction.</span></span>

<span data-ttu-id="b0478-232">Étant donné qu’il repose sur PowerShell Standard, PSES nécessite une implémentation de PowerShell au moment de l’exécution pour être testé correctement.</span><span class="sxs-lookup"><span data-stu-id="b0478-232">Because it is built against PowerShell Standard, PSES requires a runtime implementation of PowerShell in order to be tested correctly.</span></span> <span data-ttu-id="b0478-233">Pour ce faire, les tests [xUnit de PSES][] récupèrent `Microsoft.PowerShell.SDK` et `Microsoft.PowerShell.5.ReferenceAssemblies` afin de fournir une implémentation PowerShell dans l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="b0478-233">To do this, [PSES's xUnit][] tests pull in `Microsoft.PowerShell.SDK` and `Microsoft.PowerShell.5.ReferenceAssemblies` in order to provide a PowerShell implementation in the test environment.</span></span>

<span data-ttu-id="b0478-234">Comme avec PSReadLine, PSES ne peut pas prendre en charge .NET 4.6 et versions antérieures, mais il [effectue une vérification][] au moment de l’exécution avant d’appeler l’une des API qui pourraient provoquer un plantage sur les runtimes de .NET Framework inférieurs.</span><span class="sxs-lookup"><span data-stu-id="b0478-234">As with PSReadLine, PSES cannot support .NET 4.6 and below, but it [performs a check][] at runtime before calling any of the APIs that could cause a crash on the lower .NET Framework runtimes.</span></span>

### <a name="psscriptanalyzer"></a><span data-ttu-id="b0478-235">PSScriptAnalyzer</span><span class="sxs-lookup"><span data-stu-id="b0478-235">PSScriptAnalyzer</span></span>

<span data-ttu-id="b0478-236">[PSScriptAnalyzer][], le linter pour PowerShell, doit cibler des éléments syntaxiques introduits uniquement dans certaines versions de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-236">[PSScriptAnalyzer][], the linter for PowerShell, must target syntactic elements only introduced in certain versions of PowerShell.</span></span> <span data-ttu-id="b0478-237">Étant donné que la reconnaissance de ces éléments syntaxiques s’effectue en implémentant un [AstVisitor2][], il n’est pas possible d’utiliser PowerShellStandard et d’implémenter des méthodes de visiteur AST pour des syntaxes PowerShell plus récentes.</span><span class="sxs-lookup"><span data-stu-id="b0478-237">Because recognition of these syntactic elements is accomplished by implementing an [AstVisitor2][], it's not possible to use PowerShellStandard and also implement AST visitor methods for newer PowerShell syntaxes.</span></span>

<span data-ttu-id="b0478-238">Au lieu de cela, PSScriptAnalyzer [cible chaque version de PowerShell][] en tant que configuration de build, et produit une DLL distincte pour chacune d’elles.</span><span class="sxs-lookup"><span data-stu-id="b0478-238">Instead, PSScriptAnalyzer [targets each PowerShell version][] as a build configuration, and produces a separate DLL for each of them.</span></span> <span data-ttu-id="b0478-239">Cela augmente la taille et la complexité des builds, mais autorise :</span><span class="sxs-lookup"><span data-stu-id="b0478-239">This increases build size and complexity, but allows:</span></span>

- <span data-ttu-id="b0478-240">Le ciblage d’API spécifique à la version</span><span class="sxs-lookup"><span data-stu-id="b0478-240">Version-specific API targeting</span></span>
- <span data-ttu-id="b0478-241">L’implémentation de fonctionnalités spécifiques à la version pratiquement sans coût d’exécution</span><span class="sxs-lookup"><span data-stu-id="b0478-241">Version-specific functionality to be implemented with essentially no runtime cost</span></span>
- <span data-ttu-id="b0478-242">La prise en charge totale de Windows PowerShell jusqu’à .NET Framework 4.5.2</span><span class="sxs-lookup"><span data-stu-id="b0478-242">Total support for Windows PowerShell all the way down to .NET Framework 4.5.2</span></span>

## <a name="summary"></a><span data-ttu-id="b0478-243">Résumé</span><span class="sxs-lookup"><span data-stu-id="b0478-243">Summary</span></span>

<span data-ttu-id="b0478-244">Dans cet article, nous avons listé et abordé les packages NuGet qu’il est possible de cibler lors de l’implémentation d’un projet .NET qui utilise PowerShell ainsi que les raisons qui peuvent vous amener à utiliser tel ou tel.</span><span class="sxs-lookup"><span data-stu-id="b0478-244">In this article, we've listed and discussed the NuGet packages available to target when implementing a .NET project that uses PowerShell, and the reasons you might have for using one over another.</span></span>

<span data-ttu-id="b0478-245">Si vous êtes directement allé au résumé, voici certaines recommandations générales :</span><span class="sxs-lookup"><span data-stu-id="b0478-245">If you've skipped to the summary, some broad recommendations are:</span></span>

- <span data-ttu-id="b0478-246">Les modules **PowerShell** doivent être compilés par rapport à PowerShell Standard s’ils nécessitent uniquement des API communes à différentes versions de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-246">PowerShell **modules** should compile against PowerShell Standard if they only require APIs common to different PowerShell versions.</span></span>
- <span data-ttu-id="b0478-247">Les **hôtes et applications** PowerShell qui sont amenés à exécuter PowerShell en interne doivent cibler le SDK PowerShell pour PowerShell versions 6 et ultérieures ou les assemblys de référence Windows PowerShell appropriés pour Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b0478-247">PowerShell **hosts and applications** that need to run PowerShell internally should target the PowerShell SDK for PowerShell 6+ or the relevant Windows PowerShell reference assemblies for Windows PowerShell.</span></span>
- <span data-ttu-id="b0478-248">Les modules PowerShell qui nécessitent des **API spécifiques à la version** doivent cibler le SDK PowerShell ou les assemblys de référence de Windows PowerShell pour les versions de PowerShell nécessaires, en les utilisant en tant qu’assemblys de référence (c’est-à-dire en ne publiant pas les dépendances PowerShell).</span><span class="sxs-lookup"><span data-stu-id="b0478-248">PowerShell modules that need **version-specific APIs** should target the PowerShell SDK or Windows PowerShell reference assemblies for the required PowerShell versions, using them as reference assemblies (that is, not publishing the PowerShell dependencies).</span></span>

<!--link references -->

[.NET Standard 2.0]: /dotnet/standard/net-standard
[.NET Standard 2.0]: /dotnet/standard/net-standard
[about_Modules]: /powershell/module/microsoft.powershell.core/about/about_modules
[Add-Type]: /powershell/module/microsoft.powershell.utility/add-type
[AstVisitor2]: /dotnet/api/system.management.automation.language.astvisitor2
[CmdletProvider]: /dotnet/api/system.management.automation.provider.cmdletprovider
[CreateDefault2]: /dotnet/api/system.management.automation.runspaces.initialsessionstate.createdefault2
[csproj]: https://github.com/PowerShell/PSReadLine/blob/master/PSReadLine/PSReadLine.csproj
[Microsoft.PowerShell.SDK]: https://www.nuget.org/packages/Microsoft.PowerShell.SDK/
[NETStandard.Library]: https://www.nuget.org/packages/NETStandard.Library/
[NuGet]: https://www.nuget.org/
[Effectue une vérification]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[performs a check]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[Pester]: https://github.com/Pester/Pester
[PowerShell Editor Services]: https://github.com/PowerShell/PowerShellEditorServices/
[Extension PowerShell]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[PowerShell extension]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[NuGet PowerShell]: https://www.nuget.org/packages/PowerShell/
[PowerShell NuGet]: https://www.nuget.org/packages/PowerShell/
[Dépôt PowerShell Standard]: https://github.com/PowerShell/PowerShellStandard
[PowerShell Standard repository]: https://github.com/PowerShell/PowerShellStandard
[PowerShellStandard.Library]: https://www.nuget.org/packages/PowerShellStandard.Library/
[PSCmdlet]: /dotnet/api/system.management.automation.pscmdlet
[xUnit de PSES]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSES's xUnit]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSHost]: /dotnet/api/system.management.automation.host.pshost
[Attribut PrivateAssets]: /dotnet/core/tools/csproj#packagereference
[PrivateAssets attribute]: /dotnet/core/tools/csproj#packagereference
[PSReadLine]: https://github.com/PowerShell/PSReadLine
[PSScriptAnalyzer]: https://github.com/powershell/psscriptanalyzer
[Assemblys de référence]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[reference assemblies]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[Start-Job]: /powershell/module/microsoft.powershell.core/start-job
[System.Management.Automation]: https://www.nuget.org/packages/System.Management.Automation/
[Cible chaque version de PowerShell]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[targets each PowerShell version]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[Ce billet de blog]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[this blog post]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[Visual Studio Code]: https://code.visualstudio.com/
[Windows PowerShell SDK]: /powershell/scripting/developer/windows-powershell
